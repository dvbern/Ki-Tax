<!--
  ~ Ki-Tax: System for the management of external childcare subsidies
  ~ Copyright (C) 2017 City of Bern Switzerland
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~ GNU Affero General Public License for more details.
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see <http://www.gnu.org/licenses/>.
  -->

<div class="kindView gesuch-modul static-position">
    <h1 class="access-for-all-title" data-translate="AFA_GESUCHSFORMULAR"></h1>
    <div class="row view-title">
        <div class="col-md-12">
            <h2>
                <span data-translate="KIND"></span> {{vm.getContainer() ? vm.getContainer().kindNummer : ''}}
            </h2>
            <dv-bisher gs="vm.getContainer().kindGS"
                       ja="vm.getContainer().kindJA"
                       specific-bisher-text="'DURCH_GEMEINDE_ERFASST' | translate"
                       show-specific-bisher-text-if-bisher-none="true"></dv-bisher>
            <hr class="header"/>
            <p class="inline-hint" data-translate="PFLICHTFELDER_HINT" ng-if="!vm.isLuzern"></p>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <form role="form" name="vm.form" class="" novalidate unsaved-warning-form>
                <fieldset ng-disabled="vm.isGesuchReadonly()">

                    <!--Geschlecht-->
                    <div class="row" ng-if="vm.isGeschlechtOfKindRequired()">
                        <div class="col-xs-12 dv-input-container-small">
                            <div class="form-group">
                                <label class="md-no-float required"
                                       for="geschlecht"
                                       data-translate="GESCHLECHT"></label>
                                <dv-radio-container name="geschlecht" class="input-element"
                                                    aria-label="{{'GESCHLECHT' | translate}}"
                                                    id="geschlecht"
                                                    dv-enable-element
                                                    dv-enable-allowed-roles="vm.allowedRoles"
                                                    dv-enable-expression="!vm.isGesuchReadonly()"
                                                    ng-required="true" items="vm.geschlechter"
                                                    ng-model="vm.getModel().geschlecht"
                                                    aria-described-by="geschlecht-error">
                                </dv-radio-container>
                                <dv-bisher gs="vm.getContainer().kindGS.geschlecht"
                                           ja="vm.getContainer().kindJA.geschlecht"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                <dv-error-messages input-id="geschlecht" for="vm.form.geschlecht.$error"
                                                   class="error"></dv-error-messages>
                            </div>
                        </div>
                    </div>
                    <!--Vorname/Name-->
                    <div class="row">
                        <div class="col-sm-12 dv-input-container-small">
                            <dv-input-container class="form-group">
                                <label class="md-no-float" data-translate="VORNAME" for="vorname_ID"></label>
                                <input aria-describedby="vorname_ID-error" id="vorname_ID" type="text" name="vorname"
                                       data-test="vorname"
                                       ng-model="vm.getModel().vorname"
                                       dv-max-length class="form-control" required>
                                <dv-bisher gs="vm.getContainer().kindGS.vorname"
                                           ja="vm.getContainer().kindJA.vorname"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                <dv-error-messages input-id="vorname_ID" for="vm.form.vorname.$error"
                                                   class="error"></dv-error-messages>
                            </dv-input-container>
                        </div>
                        <div class="col-sm-12 dv-input-container-small">
                            <dv-input-container class="form-group secondColumn">
                                <label class="md-no-float" data-translate="NAME" for="name_ID"></label>
                                <input aria-describedby="name_ID-error"
                                       data-test="nachname"
                                       id="name_ID"
                                       type="text"
                                       name="name"
                                       ng-model="vm.getModel().nachname"
                                       dv-max-length
                                       class="form-control"
                                       required>
                                <dv-bisher gs="vm.getContainer().kindGS.nachname"
                                           ja="vm.getContainer().kindJA.nachname"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                <dv-error-messages input-id="name_ID" for="vm.form.name.$error"
                                                   class="error"></dv-error-messages>
                            </dv-input-container>
                        </div>
                    </div>

                    <!--Geburtsdatum-->
                    <div class="row">
                        <div class="col-sm-12 dv-input-container-small">
                            <dv-input-container class="form-group">
                                <label class="md-no-float" data-translate="GEBURTSDATUM" for="geburtsdatum_ID">
                                </label>
                                <dv-datepicker no-future="!(vm.kontingentierungEnabled)"
                                               input-id="geburtsdatum_ID" name="geburtsdatum"
                                               data-test="geburtsdatum"
                                               ng-model="vm.getModel().geburtsdatum" ng-required="true"
                                               class="input-element"
                                               ng-blur="vm.geburtsdatumChanged()"
                                               ng-attr-placeholder="{{'DATE_PLACEHOLDER' | translate}}">
                                </dv-datepicker>

                                <dv-bisher gs="vm.getContainer().kindGS.geburtsdatum"
                                           ja="vm.getContainer().kindJA.geburtsdatum"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                <dv-error-messages input-id="geburtsdatum_ID"
                                                   for="vm.form.geburtsdatum.$error"></dv-error-messages>
                            </dv-input-container>
                        </div>
                    </div>
                    <div class="row" ng-if="vm.showGeburtsdatumWarning()">
                        <div class="col-md-12">
                            <div class="well well-status-warten">
                                <span>{{'KIND_WARNING_ZUNKUNFTIGE_GEBURTSDATUM' | translate }}</span>
                            </div>
                        </div>
                    </div>

                    <ng-container ng-if="vm.showAsivKinderabzug()">
                        <!-- Kinderabzug: Erstes Halbjahr -->
                        <div class="row">
                            <div class="col-xs-12 dv-input-container-question">
                                <dv-input-container class="form-group">
                                <span class="ebegu-h1 required">
                                    <span data-translate="KINDERABZUG"
                                          data-translate-value-jahr="{{vm.getBasisjahrPlus1()}}"></span>
                                    <dv-tooltip input-id="kinderabzugErstesHalbjahr"
                                                text="'KINDERABZUG_HELP' | translate"></dv-tooltip>
                                </span>
                                    <dv-radio-container name="kinderabzugErstesHalbjahr" ng-model="vm.getModel().kinderabzugErstesHalbjahr"
                                                        ng-required="vm.showAsivKinderabzug()"
                                                        dv-enable-element
                                                        dv-enable-allowed-roles="vm.allowedRoles"
                                                        dv-enable-expression="!vm.isGesuchReadonly()"
                                                        class="input-element" items="vm.kinderabzugValues"
                                                        aria-label="{{ 'KINDERABZUG' |translate}}"
                                                        aria-described-by="kinderabzugErstesHalbjahr-error">
                                    </dv-radio-container>
                                    <dv-bisher gs="vm.getContainer().kindGS.kinderabzugErstesHalbjahr"
                                               ja="vm.getContainer().kindJA.kinderabzugErstesHalbjahr"
                                               show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                    <dv-error-messages input-id="kinderabzugErstesHalbjahr" for="vm.form.kinderabzugErstesHalbjahr.$error"
                                                       class="error"></dv-error-messages>
                                </dv-input-container>
                            </div>
                        </div>
                        <!-- Kinderabzug: Zweites Halbjahr -->
                        <div class="row">
                            <div class="col-xs-12 dv-input-container-question">
                                <dv-input-container class="form-group">
                                <span class="ebegu-h1 required">
                                    <span data-translate="KINDERABZUG"
                                          data-translate-value-jahr="{{vm.getBasisjahrPlus2()}}"></span>
                                    <dv-tooltip input-id="kinderabzugZweitesHalbjahr"
                                                text="'KINDERABZUG_HELP' | translate"></dv-tooltip>
                                </span>
                                    <dv-radio-container name="kinderabzugZweitesHalbjahr" ng-model="vm.getModel().kinderabzugZweitesHalbjahr"
                                                        ng-required="vm.showAsivKinderabzug()"
                                                        dv-enable-element
                                                        dv-enable-allowed-roles="vm.allowedRoles"
                                                        dv-enable-expression="!vm.isGesuchReadonly()"
                                                        class="input-element" items="vm.kinderabzugValues"
                                                        aria-label="{{ 'KINDERABZUG' |translate}}"
                                                        aria-described-by="kinderabzugZweitesHalbjahr-error">
                                    </dv-radio-container>
                                    <dv-bisher gs="vm.getContainer().kindGS.kinderabzugZweitesHalbjahr"
                                               ja="vm.getContainer().kindJA.kinderabzugZweitesHalbjahr"
                                               show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                    <dv-error-messages input-id="kinderabzugZweitesHalbjahr" for="vm.form.kinderabzugZweitesHalbjahr.$error"
                                                       class="error"></dv-error-messages>
                                </dv-input-container>
                            </div>
                        </div>
                    </ng-container>

                    <dv-fkjv-kinderabzug
                        ng-if="vm.showFkjvKinderabzug() && vm.isGeburtsdatumValid()"
                        [kind-container]="vm.getContainer()"
                    ></dv-fkjv-kinderabzug>

                    <!--familienErgaenzendeBetreuung-->
                    <div class="row" ng-if="!vm.showFkjvKinderabzug()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="form-group">
                                <span class="ebegu-h1 required">
                                    <span ng-if="vm.hasAngebotBGOnly()"
                                          data-translate="FAM_ERGAENZENDE_BETREUUNG"></span>
                                    <span ng-if="vm.hasAngebotTSOnly()"
                                          data-translate="FAM_ERGAENZENDE_BETREUUNG_TS"></span>
                                    <span ng-if="vm.hasAngebotBGAndTS()"
                                          data-translate="FAM_ERGAENZENDE_BETREUUNG_BEIDE"></span>
                                </span>
                                <!-- TODO @Franzi warum ist der check anders bei der Text als bei der Checkbox? -->
                                <span
                                    ng-if="!vm.isGesuchReadonly() && !vm.isKorrekturModusJugendamt() && vm.hasKindBetreuungen()"
                                    class="inline-hint"
                                    data-translate="FAM_ERGAENZENDE_BETREUUNG_NOT_EDITABLE"></span>

                                <dv-radio-container name="familienErgaenzendeBetreuung" class="input-element"
                                                    dv-enable-element
                                                    dv-enable-allowed-roles="vm.allowedRoles"
                                                    dv-enable-expression="!vm.isGesuchReadonly() && !vm.hasKindBetreuungen()"
                                                    ng-required="true"
                                                    ng-model="vm.getModel().familienErgaenzendeBetreuung"
                                                    ng-change="vm.familienErgaenzendeBetreuungClicked()"
                                                    aria-label="{{ 'FAM_ERGAENZENDE_BETREUUNG' |translate}}"
                                                    aria-described-by="familienErgaenzendeBetreuung-error">
                                </dv-radio-container>
                                <dv-bisher gs="vm.getContainer().kindGS.familienErgaenzendeBetreuung"
                                           ja="vm.getContainer().kindJA.familienErgaenzendeBetreuung"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                <dv-error-messages input-id="familienErgaenzendeBetreuung"
                                                       for="vm.form.familienErgaenzendeBetreuung.$error"
                                                   class="error"></dv-error-messages>
                            </div>
                        </div>
                    </div>

                    <!--sprichtAmtssprache-->
                    <div ng-if="vm.isGeburtsdatumValid() && !vm.isOrGetsKindVolljaehrigDuringGP() || !vm.showFkjvKinderabzug()">
                        <div class="row" ng-if="!vm.isSpracheAmtspracheDisabled ">
                            <div class="col-xs-12 dv-input-container-question">
                                <div class="form-group" ng-show="vm.getModel().familienErgaenzendeBetreuung">
                                    <span class="ebegu-h1 required">
                                        <span>{{vm.getTextSprichtAmtssprache()}}</span>
                                        <dv-tooltip input-id="sprichtAmtssprache"
                                                    text="'SPRICHT_AMTSSPRACHE_HELP' | translate"></dv-tooltip>
                                    </span>

                                    <dv-radio-container name="sprichtAmtssprache" class="input-element"
                                                        dv-enable-element
                                                        dv-enable-allowed-roles="vm.allowedRoles"
                                                        dv-enable-expression="!vm.isGesuchReadonly()"
                                                        ng-required="vm.getModel().familienErgaenzendeBetreuung"
                                                        ng-model="vm.getModel().sprichtAmtssprache"
                                                        aria-label="{{vm.getTextSprichtAmtssprache()}}"
                                                        aria-described-by="sprichtAmtssprache-error">
                                    </dv-radio-container>
                                    <dv-bisher gs="vm.getContainer().kindGS.sprichtAmtssprache"
                                               ja="vm.getContainer().kindJA.sprichtAmtssprache"
                                               show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                    <dv-error-messages input-id="sprichtAmtssprache"
                                                       for="vm.form.sprichtAmtssprache.$error"
                                                       class="error"></dv-error-messages>
                                </div>
                            </div>
                        </div>

                        <!--Welche Klasse wird Ihr Kind am 01.08.XXXX besuchen?-->
                        <div class="row">
                            <div class="col-xs-12 dv-input-container-question">
                                <div class="form-group" ng-if="vm.getModel().familienErgaenzendeBetreuung">
                                    <span class="ebegu-h1 required">
                                        <span data-translate="EINSCHULUNG"
                                              data-translate-value-jahr="{{vm.getYearEinschulung()}}">
                                        </span>
                                         <dv-tooltip input-id="einschulungTyp"
                                                     text="'EINSCHULUNG_HINT' | translate"></dv-tooltip>
                                    </span>
                                    <div class="dv-select-style">
                                        <select name="einschulungTyp" id="einschulungTyp"
                                                data-test="einschulung-typ"
                                                class="form-control"
                                                aria-describedby="einschulungTyp-error"
                                                dv-enable-element
                                                dv-enable-allowed-roles="vm.allowedRoles"
                                                dv-enable-expression="!vm.isGesuchReadonly()"
                                                ng-change="vm.einschulungTypChanged()"
                                                ng-model="vm.getModel().einschulungTyp"
                                                ng-options="typ | translate for typ in vm.einschulungTypValues track by typ"
                                                ng-required="vm.getModel().familienErgaenzendeBetreuung">
                                        </select>
                                        <dv-bisher gs="vm.getContainer().kindGS.einschulungTyp"
                                                   ja="vm.getContainer().kindJA.einschulungTyp"
                                                   show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                        <dv-error-messages input-id="einschulungTyp" for="vm.form.einschulungTyp.$error">
                                        </dv-error-messages>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="row" ng-if="vm.isEinschulungTypObligatorischerKindergarten()">
                            <div class="col-xs-12 dv-input-container-question">
                                <div class="checkbox checkbox-with-margin no-tooltip margin-bottom-4rem">
                                    <md-checkbox ng-model="vm.getModel().keinPlatzInSchulhort"
                                                 data-test="kein-platz-in-schulhort"
                                                 name="keinPlatzInSchulhort"
                                                 id="keinPlatzInSchulhort"
                                                 aria-label="{{'KEIN_PLATZ_IN_SCHULHORT'|translate}}"
                                                 ng-disabled="vm.isGesuchReadonly()">
                                        <span data-translate="KEIN_PLATZ_IN_SCHULHORT"></span>
                                    </md-checkbox>
                                    <dv-bisher gs="vm.model.kindGS.keinPlatzInSchulhort"
                                               ja="vm.model.kindJA.keinPlatzInSchulhort"
                                               show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                </div>
                            </div>
                        </div>

                        <dv-schwyz-kinderabzug
                            ng-if="vm.showSchwyzKinderabzug()"
                            [kind-container]="vm.getContainer()"
                        ></dv-schwyz-kinderabzug>

                        <ng-container ng-if="vm.showExtendedKindQuestions()">
                            <!--Show Fachstelle?-->
                            <div class="row" ng-if="vm.isFachstellenActivated()">
                                <div class="col-xs-12 dv-input-container-question">
                                    <div class="checkbox checkbox-with-margin"
                                         ng-show="vm.getModel().familienErgaenzendeBetreuung">
                                        <md-checkbox ng-model="vm.showFachstelle"
                                                     data-test="show-fachstelle"
                                                     name="showFachstelle"
                                                     id="showFachstelle"
                                                     aria-label="{{'INVOLVIERTE_FACHSTELLE'|translate}}"
                                                     ng-disabled="vm.isGesuchReadonly()"
                                                     ng-change="vm.showFachstelleClicked()">
                                            <span data-translate="INVOLVIERTE_FACHSTELLE"></span>
                                        </md-checkbox>
                                        <dv-tooltip input-id="showFachstelle"
                                                    text="'INVOLVIERTE_FACHSTELLE_HELP' | translate"></dv-tooltip>
                                        <dv-bisher gs="vm.showFachstelleGS"
                                                   ja="vm.showFachstelle"
                                                   specific-bisher-text="vm.getTextFachstelleKorrekturJA()"
                                                   show-if-bisher-none="vm.isNotNullOrUndefined(vm.getContainer().kindGS)"></dv-bisher>
                                    </div>
                                </div>
                            </div>
                            <div ng-if="vm.isFachstelleRequired()">
                                <div ng-repeat="pensumFachstelle in vm.getPensumFachstellen() track by $index">
                                    <dv-kind-fachstelle
                                        [pensum-fachstelle]="pensumFachstelle"
                                        [pensum-fachstellen-list]="vm.getPensumFachstellen()"
                                        [submitted]="vm.submitted"
                                        [index]="$index"
                                        (on-pensum-fachstellen-overlaps)="vm.setFachstellenPensumOverlaps($event)"
                                    ></dv-kind-fachstelle>
                                    <div class="row margin-bottom-60 dv-input-container-medium"
                                         ng-if="($index > 0) || (vm.getPensumFachstellen().length > 1)">
                                        <div class="col-md-12">
                                            <dv-loading-button type="button"
                                                               button-click="vm.removePensumFachstelle($index)"
                                                               button-class="dv-btn-operation"
                                                               button-disabled="vm.isGesuchReadonly()">
                                                <i class="fa fa-lg fa-trash-o"
                                                   title="{{'PENSUM_FACHSTELLE_ENTFERNEN' | translate}}"
                                                   aria-label="{{'PENSUM_FACHSTELLE_ENTFERNEN' | translate}}"></i>
                                                <span data-translate="PENSUM_FACHSTELLE_ENTFERNEN"
                                                      data-translate-value-fachstellennummer="{{$index + 1}}"></span>
                                            </dv-loading-button>
                                            <hr class="header"/>
                                        </div>
                                    </div>
                                </div>

                                <dv-demo-feature-wrapper [demo-feature]="vm.demoFeature">
                                    <div class="row margin-bottom-50">
                                        <div class="col-md-12">
                                            <dv-loading-button type="button" button-click="vm.addNewPensumFachstelle()"
                                                               delay="0"
                                                               button-class="dv-btn-operation">
                                                <i class="fa fa-lg fa-plus-circle"></i>
                                                <span data-translate="PENSUM_FACHSTELLE_ERFASSEN"></span>
                                            </dv-loading-button>
                                        </div>
                                    </div>
                                    <div class="row margin-bottom-50" ng-if="vm.showWarningPensumOverlaps()">
                                        <div class="col-md-12">
                                            <div class="well well-status-abgewiesen">
                                                <span translate>{{vm.getMessageKeyWarnFachstellenPensumOverlap()}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </dv-demo-feature-wrapper>
                            </div>
                            <!--Asylwesen?-->
                            <div class="row" ng-if="vm.showAusAsylwesen()">
                                <div class="col-xs-12 dv-input-container-question">
                                    <div class="checkbox checkbox-with-margin">
                                        <md-checkbox ng-model="vm.getModel().ausAsylwesen" name="showAsylwesen"
                                                     data-test="show-asylwesen"
                                                     id="showAsylwesen"
                                                     aria-label="{{'KIND_AUS_ASYLWESEN'|translate}}"
                                                     ng-change="vm.deleteZemisNummer(vm.getModel())"
                                                     ng-disabled="vm.isGesuchReadonly()">
                                            <span data-translate="KIND_AUS_ASYLWESEN"></span>
                                        </md-checkbox>
                                        <dv-tooltip input-id="showAsylwesen"
                                                    text="'KIND_AUS_ASYLWESEN_HELP' | translate"></dv-tooltip>
                                        <dv-error-messages for="vm.form.showAsylwesen.$error"
                                                           class="error"></dv-error-messages>
                                    </div>
                                </div>
                            </div>

                            <!-- ZEMIS Nummer -->
                            <div ng-if="vm.showZemisNummer()">
                                <div class="row" id="zemis-nummer">
                                    <div class="col-sm-4 col-xs-12 dv-input-container-small">
                                        <dv-input-container class="form-group">
                                            <label class="md-no-float" data-translate="ZEMIS_NUMMER"
                                                   for="zemisNummer"></label>
                                            <input aria-describedby="zemisNummer-error"
                                                   data-test="zemis-nummer"
                                                   id="zemisNummer" type="text"
                                                   name="zemisNummer"
                                                   ng-model="vm.getModel().zemisNummer"
                                                   max="10" dv-max-length class="form-control"
                                                   ng-pattern="vm.CONSTANTS.PATTERN_ZEMIS_NUMMER"
                                                   ng-required="vm.getModel().ausAsylwesen"
                                                   ng-attr-placeholder="{{'ZEMIS_NUMMER_PLACEHOLDER' | translate}}">
                                            <dv-error-messages input-id="zemisNummer"
                                                               for="vm.form.zemisNummer.$error"
                                                               class="error"></dv-error-messages>
                                        </dv-input-container>
                                    </div>
                                    <div class="col-sm-8 col-xs-12 dv-input-container-question"
                                         ng-if="vm.showKeinSelbstbehaltDurchGemeinde()">
                                        <div class="checkbox checkbox-with-margin">
                                            <md-checkbox ng-model="vm.getContainer().keinSelbstbehaltDurchGemeinde"
                                                         data-test="kein-selbstbehalt-durch-gemeinde"
                                                         name="keinSelbstbehaltDurchGemeinde"
                                                         id="keinSelbstbehaltDurchGemeinde"
                                                         aria-label="{{'KEIN_SELBSTBEHALT_DURCH_GEMEINDE'|translate}}"
                                                         ng-disabled="true">
                                                <span data-translate="KEIN_SELBSTBEHALT_DURCH_GEMEINDE"></span>
                                            </md-checkbox>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ausserordentlicher Anpruch? -->
                            <div class="row">
                                <div class="col-xs-12 dv-input-container-question">
                                    <div class="checkbox checkbox-with-margin"
                                         ng-show="vm.showAusserordentlicherAnspruchCheckbox()">
                                        <md-checkbox ng-model="vm.showAusserordentlicherAnspruch"
                                                     data-test="show-ausserordentlicher-anspruch"
                                                     name="showAusserordentlicherAnspruch"
                                                     id="showAusserordentlicherAnspruch"
                                                     aria-label="{{'AUSSERORDENTLICHER_ANSPRUCH'|translate}}"
                                                     ng-disabled="vm.isGesuchReadonly() || !vm.isAusserordentlicherAnspruchEnabled()"
                                                     ng-change="vm.showAusserordentlicherAnspruchClicked()">
                                            <span data-translate="AUSSERORDENTLICHER_ANSPRUCH"></span>
                                        </md-checkbox>
                                        <dv-tooltip ng-if="!vm.gesuchModelManager.isFKJVTexte" input-id="showAusserordentlicherAnspruch"
                                                    text="'AUSSERORDENTLICHER_ANSPRUCH_HINT' | translate"></dv-tooltip>
                                        <dv-tooltip ng-if="vm.gesuchModelManager.isFKJVTexte" input-id="showAusserordentlicherAnspruch"
                                                    text="'AUSSERORDENTLICHER_ANSPRUCH_HINT_FKJV' | translate"></dv-tooltip>
                                        <dv-error-messages for="vm.form.showAusserordentlicherAnspruch.$error"
                                                           class="error"></dv-error-messages>
                                    </div>
                                </div>
                            </div>

                            <div ng-if="vm.isAusserordentlicherAnspruchRequired()">
                                <div class="row">
                                    <div class="col-sm-12 dv-input-container-medium form-group">
                                        <dv-input-container class="form-group">
                                            <label class="md-no-float" for="begruendung"
                                                   data-translate="AUSSERORDENTLICHER_ANSPRUCH_BEGRUENDUNG"></label>
                                            <textarea md-no-autogrow class="form-control" rows="6" maxlength="4000"
                                                      data-test="ausserordentlich-begruendung"
                                                      ng-maxlength="3000"
                                                      ng-minlength="5"
                                                      id="begruendung" name="begruendung"
                                                      ng-model="vm.getPensumAusserordentlicherAnspruch().begruendung"
                                                      ng-required="vm.isAusserordentlicherAnspruchRequired()"
                                                      ng-disabled="!vm.isAusserordentlicherAnspruchEnabled()">
                                        </textarea>
                                            <dv-error-messages input-id="begruendung" for="vm.form.begruendung.$error"
                                                               class="error"></dv-error-messages>
                                        </dv-input-container>

                                    </div>
                                </div>

                                <!-- Anspruchspensum -->
                                <div class="row">
                                    <div class="col-sm-12 dv-input-container-small">
                                        <dv-input-container class="form-group">
                                            <label class="md-no-float"
                                                   data-translate="AUSSERORDENTLICHER_ANSPRUCH_BETREUUNGSPENSUM"
                                                   for="betreuungspensumAusserordentlicherAnspruch"></label>
                                            <input aria-describedby="betreuungspensumAusserordentlicherAnspruch-error"
                                                   data-test="betreuungspensum-ausserordentlicher-anspruch"
                                                   id="betreuungspensumAusserordentlicherAnspruch" type="number"
                                                   name="betreuungspensumAusserordentlicherAnspruch"
                                                   ng-model="vm.getPensumAusserordentlicherAnspruch().pensum"
                                                   max="{{vm.maxPensumAusserordentlicherAnspruch}}" class="form-control"
                                                   ng-pattern="vm.CONSTANTS.PATTERN_PERCENTAGE"
                                                   ng-required="vm.isAusserordentlicherAnspruchRequired()"
                                                   ng-attr-placeholder="{{'PERCENTAGE_PLACEHOLDER' | translate}}"
                                                   ng-disabled="!vm.isAusserordentlicherAnspruchEnabled()">
                                            <dv-error-messages input-id="betreuungspensumAusserordentlicherAnspruch"
                                                               for="vm.form.betreuungspensumAusserordentlicherAnspruch.$error"
                                                               class="error"></dv-error-messages>
                                        </dv-input-container>
                                    </div>
                                </div>

                                <!-- gueltig ab / gueltig bis -->
                                <div class="row">
                                    <div class="col-sm-12 dv-input-container-small">
                                        <dv-input-container class="form-group">
                                            <label class="md-no-float" data-translate="VON"
                                                   for="aussAnspruchDatumAb"></label>
                                            <dv-datepicker input-id="aussAnspruchDatumAb" name="aussAnspruchDatumAb"
                                                           data-test="auss-anspruch-datum-ab"
                                                           class="input-element"
                                                           ng-model="vm.getPensumAusserordentlicherAnspruch().gueltigkeit.gueltigAb"
                                                           ng-required="vm.isAusserordentlicherAnspruchRequired()"
                                                           ng-attr-placeholder="{{'DATE_PLACEHOLDER' | translate}}"
                                                           ng-disabled="!vm.isAusserordentlicherAnspruchEnabled()">
                                            </dv-datepicker>
                                            <dv-error-messages input-id="aussAnspruchDatumAb" class="error"
                                                               for="vm.form.aussAnspruchDatumAb.$error"></dv-error-messages>
                                        </dv-input-container>
                                    </div>
                                    <div class="col-sm-12 dv-input-container-small">
                                        <dv-input-container class="form-group">
                                            <label class="md-no-float" data-translate="BIS" for="aussAnspruchDatumBis">
                                            </label>
                                            <dv-datepicker input-id="aussAnspruchDatumBis" name="aussAnspruchDatumBis"
                                                           data-test="auss-anspruch-datum-bis"
                                                           class="input-element"
                                                           ng-model="vm.getPensumAusserordentlicherAnspruch().gueltigkeit.gueltigBis"
                                                           ng-required="false"
                                                           ng-attr-placeholder="{{'DATE_PLACEHOLDER' | translate}}"
                                                           ng-disabled="!vm.isAusserordentlicherAnspruchEnabled()">
                                            </dv-datepicker>
                                            <dv-error-messages input-id="aussAnspruchDatumBis" class="error"
                                                               for="vm.form.aussAnspruchDatumBis.$error"></dv-error-messages>
                                        </dv-input-container>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </fieldset>


                <!--Buttons-->
                <dv-navigation dv-cancel="vm.cancel()"
                               dv-next="!vm.isGesuchReadonly()"
                               dv-save="vm.save()" dv-sub-step="2"
                               dv-translate-next="{{'SPEICHERN'}}">
                </dv-navigation>
            </form>
        </div>
    </div>
</div>
