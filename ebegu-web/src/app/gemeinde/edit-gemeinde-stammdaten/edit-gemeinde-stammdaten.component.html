<!--
  ~ Copyright (C) 2019 DV Bern AG, Switzerland
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->

<div class="dv-content"
     *ngIf="stammdaten$ | async as stammdaten">
    <div *ngIf="editMode; else viewModeTemplate">
        <fieldset ngModelGroup="dv-edit-gemeinde-stammdaten">
            <div class="row marginTop20">
                <!-- Anschrift -->
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="required" translate for="anschrift_id">ADRESSE_ANSCHRIFT</label>
                        <input id="anschrift_id" type="text" name="anschrift_id" #nameAnschrift="ngModel"
                               [(ngModel)]="stammdaten.adresse.organisation"
                               [maxlength]="255" class="form-control" required ng-required="true"
                               placeholder="{{'AMT_JUGENDAMT'|translate}}, {{'AMT_SCHULAMT'|translate}}, ...">
                        <dv-error-messages [errorObject]="nameAnschrift.errors"
                                           inputId="anschrift_id"></dv-error-messages>
                    </div>
                </div>
                <!-- E-Mail -->
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="required" translate for="e_mail_id">EMAIL</label>
                        <input id="e_mail_id" type="email" name="e_mail_id" #nameEmail="ngModel"
                               [(ngModel)]="stammdaten.mail"
                               [maxlength]="255" class="form-control" required>
                        <dv-error-messages [errorObject]="nameEmail.errors"
                                           inputId="e_mail_id"></dv-error-messages>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- Strasse -->
                <div class="col-sm-5">
                    <div class="form-group">
                        <label class="required" translate for="strasse_id">ADRESSE_STRASSE</label>
                        <input id="strasse_id" type="text" name="strasse_id" #nameStrasse="ngModel"
                               [(ngModel)]="stammdaten.adresse.strasse"
                               [maxlength]="255" class="form-control" required>
                        <dv-error-messages [errorObject]="nameStrasse.errors"
                                           inputId="strasse_id"></dv-error-messages>
                    </div>
                </div>
                <!-- Hausnummer -->
                <div class="col-sm-1">
                    <div class="form-group">
                        <label translate for="hausnummer_id">ADRESSE_NUMMER</label>
                        <input id="hausnummer_id" type="text" name="hausnummer_id" #nameHausnummer="ngModel"
                               [(ngModel)]="stammdaten.adresse.hausnummer"
                               [maxlength]="255" class="form-control">
                        <dv-error-messages [errorObject]="nameHausnummer.errors"
                                           inputId="hausnummer_id"></dv-error-messages>
                    </div>
                </div>
                <!-- Telefon -->
                <div class="col-sm-6">
                    <div class="form-group">
                        <label class="required" translate for="telefon_id">TELEFON</label>
                        <input id="telefon_id" type="text" name="telefon_id" #nameTelefon="ngModel"
                               [(ngModel)]="stammdaten.telefon"
                               [maxlength]="255" class="form-control"
                               required
                        [pattern]="CONSTANTS.PATTERN_PHONE">
                        <dv-error-messages [errorObject]="nameTelefon.errors"
                                           inputId="telefon_id"></dv-error-messages>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- PLZ -->
                <div class="col-sm-1">
                    <div class="form-group">
                        <label class="required" translate for="plz_id">ADRESSE_PLZ</label>
                        <input id="plz_id" type="text" name="plz_id" #namePLZ="ngModel"
                               [(ngModel)]="stammdaten.adresse.plz"
                               [maxlength]="255" class="form-control" required>
                        <dv-error-messages [errorObject]="namePLZ.errors"
                                           inputId="plz_id"></dv-error-messages>
                    </div>
                </div>
                <!-- Ort -->
                <div class="col-sm-5">
                    <div class="form-group">
                        <label class="required" translate for="ort_id">ADRESSE_ORT</label>
                        <input id="ort_id" type="text" name="ort_id" #nameOrt="ngModel"
                               [(ngModel)]="stammdaten.adresse.ort"
                               [maxlength]="255" class="form-control" required>
                        <dv-error-messages [errorObject]="nameOrt.errors"
                                           inputId="ort_id"></dv-error-messages>
                    </div>
                </div>
                <!-- Webseite -->
                <div class="col-sm-6">
                    <div class="form-group">
                        <label translate for="webseite_id">WEBSEITE</label>
                        <input id="webseite_id" type="text" name="webseite_id" #nameWebsite="ngModel"
                               [(ngModel)]="stammdaten.webseite"
                               [maxlength]="255" class="form-control">
                        <dv-error-messages [errorObject]="nameWebsite.errors"
                                           inputId="webseite_id"></dv-error-messages>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- Standardverantwortliche -->
                <div class="col-sm-6">
                    <div class="form-group">
                        <h3 translate
                            class="required"
                            for="verantwortliche_id">STANDARD_VERANTWORTLICHE</h3>
                        <mat-select [(ngModel)]="stammdaten.defaultBenutzer"
                                    id="verantwortliche_id"
                                    name="verantwortliche_id"
                                    class="form-control"
									#nameVerantwortliche='ngModel'
                                    [compareWith]="compareBenutzer"
                                    required>
                            <mat-option *ngFor="let vgem of benutzerListe" [value]="vgem">
                                {{vgem.vorname}} {{vgem.nachname}}
                            </mat-option>
                        </mat-select>
                        <dv-error-messages [errorObject]="nameVerantwortliche.errors"
                                           inputId="verantwortliche_id"></dv-error-messages>
                    </div>
                </div>
                <!-- Korrespondenzsprache -->
                <div class="col-sm-6">
                    <div class="form-group">
                        <h3 class="required" translate for="korrespondenzsprache_id">KORRESPONDENZSPRACHE</h3>
                        <div class="form-group" id="korrespondenzsprache_id">
                            <mat-checkbox id="korrespondenzspracheDe_id" name="korrespondenzspracheDe_id"
                                          [(ngModel)]="stammdaten.korrespondenzspracheDe">
                                {{'DEUTSCH'|translate}}
                            </mat-checkbox>
                            <mat-checkbox id="korrespondenzspracheFr_id" name="korrespondenzspracheFr_id"
                                          [(ngModel)]="stammdaten.korrespondenzspracheFr">
                                {{'FRANZOESISCH'|translate}}
                            </mat-checkbox>
                            <div class="dv-error-messages"
                                 *ngIf="!stammdaten.korrespondenzspracheDe && !stammdaten.korrespondenzspracheFr">
                                <div class="error">
                                    {{ 'ERROR_REQUIRED' | translate }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">

                <!-- Beschwerde-Adresse Checkbox -->
                <div class="col-sm-6">
                    <h3 translate for="keineBeschwerdeAdresse_id">BESCHWERDE_ADRESSE
                        <dv-tooltip inputId="keineBeschwerdeAdresse_id"
                                    [text]="'KEINE_BESCHWERDE_ADRESSE_TOOLTIP' | translate"></dv-tooltip>
                    </h3>

                    <div class="form-group">
                        <mat-radio-group name="creationType"
                                         [(ngModel)]="stammdaten.standardRechtsmittelbelehrung"
                                         required>
                            <mat-radio-button [value]="true">{{'STANDARD_TEXT'|translate}}</mat-radio-button>
                            &nbsp;
                            <mat-radio-button [value]="false">{{'BENUTZERDEFINIERTER_TEXT'|translate}}
                            </mat-radio-button>
                        </mat-radio-group>
                    </div>
                    <div class="row" *ngIf="!stammdaten.standardRechtsmittelbelehrung">
                        <div class="col-sm-12">
                            <div class="form-group" *ngIf="stammdaten.korrespondenzspracheDe">

                                <label class="required" translate for="rechtsmittelbelehrung_deutsch_textarea">RECHTSMITTELBELEHRUNG_TEXT_DE</label>

                                <textarea md-no-autogrow
                                          class="form-control"
                                          rows="6"
                                          required
                                          maxlength="4000"
                                          id="rechtsmittelbelehrung_deutsch_textarea"
										  #nameRechtmittelDE="ngModel"
                                          name="rechtsmittelbelehrung_deutsch_textarea"
                                          [(ngModel)]="stammdaten.rechtsmittelbelehrung.textDeutsch">
                                                </textarea>
                                <dv-error-messages [errorObject]="nameRechtmittelDE.errors"
                                                   inputId="rechtsmittelbelehrung_deutsch_textarea"></dv-error-messages>

                            </div>
                            <div class="form-group"
                                 id="rechtsmittelbelehrung-franzoesisch"
                                 *ngIf="stammdaten.korrespondenzspracheFr">

                                <label class="required" translate for="rechtsmittelbelehrung_franzoesisch_textarea">RECHTSMITTELBELEHRUNG_TEXT_FR</label>

                                <textarea md-no-autogrow
                                          class="form-control"
                                          rows="6"
                                          required
                                          maxlength="4000"
                                          id="rechtsmittelbelehrung_franzoesisch_textarea"
										  #nameRechtmittelFR="ngModel"
                                          name="rechtsmittelbelehrung_franzoesisch_textarea"
                                          [(ngModel)]="stammdaten.rechtsmittelbelehrung.textFranzoesisch">
                                                </textarea>
                                <dv-error-messages [errorObject]="nameRechtmittelFR.errors"
                                                   inputId="rechtsmittelbelehrung_franzoesisch_textarea"></dv-error-messages>
                            </div>
                        </div>
                    </div>
                    <div class="form-group checkbox-with-tooltip">
                        <mat-checkbox id="keineBeschwerdeAdresse_id" name="keineBeschwerdeAdresse_id"
                                      [(ngModel)]="keineBeschwerdeAdresse"
                                      (ngModelChange)="keineBeschwerdeAdresseChanged($event)">
                            {{'BESCHWERDE_ADRESSE_IDENTISCH_KONTAKT'|translate}}
                        </mat-checkbox>
                    </div>
                    <div *ngIf="!keineBeschwerdeAdresse">
                        <div class="col-sm-12">
                            <div class="row">
                                <div>
                                    <div class="form-group">
                                        <label class="required"
                                               translate
                                               for="anschrift_ba_id">ADRESSE_ANSCHRIFT</label>
                                        <input id="anschrift_ba_id"
                                               type="text"
                                               name="anschrift_ba_id"
											   #nameAnschriftBA="ngModel"
                                               [(ngModel)]="stammdaten.beschwerdeAdresse.organisation"
                                               [maxlength]="255"
                                               class="form-control"
                                               required
                                               placeholder="{{'ADRESSE_REGIERUNGSSTADTHALTERAMT_PLACEHOLDER'|translate}}">
                                        <dv-error-messages [errorObject]="nameAnschriftBA.errors"
                                                           inputId="anschrift_ba_id"></dv-error-messages>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <!-- Strasse -->
                            <div class="col-sm-10">
                                <div class="form-group">
                                    <label class="required"
                                           translate
                                           for="strasse_ba_id">ADRESSE_STRASSE</label>
                                    <input id="strasse_ba_id" type="text" name="strasse_ba_id" #nameStrasseBA="ngModel"
                                           [(ngModel)]="stammdaten.beschwerdeAdresse.strasse"
                                           [maxlength]="255" class="form-control" required>
                                    <dv-error-messages [errorObject]="nameStrasseBA.errors"
                                                       inputId="strasse_ba_id"></dv-error-messages>
                                </div>
                            </div>
                            <!-- Hausnummer -->
                            <div class="col-sm-2">
                                <div class="form-group">
                                    <label translate for="hausnummer_ba_id">ADRESSE_NUMMER</label>
                                    <input id="hausnummer_ba_id"
                                           type="text"
                                           name="hausnummer_ba_id"
										   #nameHausnummerBA="ngModel"
                                           [(ngModel)]="stammdaten.beschwerdeAdresse.hausnummer"
                                           [maxlength]="255"
                                           class="form-control">
                                    <dv-error-messages [errorObject]="nameHausnummerBA.errors"
                                                       inputId="hausnummer_ba_id"></dv-error-messages>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <!-- PLZ -->
                            <div class="col-sm-2">
                                <div class="form-group">
                                    <label class="required" translate for="plz_ba_id">ADRESSE_PLZ</label>
                                    <input id="plz_ba_id" type="text" name="plz_ba_id" #namePLZBA="ngModel"
                                           [(ngModel)]="stammdaten.beschwerdeAdresse.plz"
                                           [maxlength]="255" class="form-control" required>
                                    <dv-error-messages [errorObject]="namePLZBA.errors"
                                                       inputId="plz_ba_id"></dv-error-messages>
                                </div>
                            </div>
                            <!-- Ort -->
                            <div class="col-sm-10">
                                <div class="form-group">
                                    <label class="required" translate for="ort_ba_id">ADRESSE_ORT</label>
                                    <input id="ort_ba_id" type="text" name="ort_ba_id" #nameOrtBA="ngModel"
                                           [(ngModel)]="stammdaten.beschwerdeAdresse.ort"
                                           [maxlength]="255" class="form-control" required>
                                    <dv-error-messages [errorObject]="nameOrtBA.errors"
                                                       inputId="ort_ba_id"></dv-error-messages>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Konfiguration der Angebote -->
                <div class="col-sm-6">

                    <div class="form-group">
                        <label class="md-no-float" translate for="begu_start_ID" *ngIf="tageschuleEnabledForMandant">GEMEINDE_ANGEBOT</label>

                        <mat-checkbox id="angebotBG" name="angebotBG"
                                      [(ngModel)]="stammdaten.gemeinde.angebotBG"
                                      *ngIf="tageschuleEnabledForMandant"
                                      [disabled]="!(isSuperadminOrMandant())">
                            {{'GEMEINDE_ANGEBOT_BETREUUNGSGUTSCHEINE'|translate}}</mat-checkbox>

                        <div class="form-group" *ngIf="stammdaten.gemeinde.angebotBG">
                            <label class="md-no-float" translate for="begu_start_ID">BEGU_START</label>
                            <input class="dv-mat-datepicker" type="text"
                                   name="begu_start" id="begu_start_ID" #bgStartDate="ngModel"
                                   [(ngModel)]="stammdaten.gemeinde.betreuungsgutscheineStartdatum"
                                   [matDatepicker]="begu_start"
                                   [disabled]="!(isSuperadminOrMandant())"
                                   placeholder="{{'DATE_PLACEHOLDER_FIRSTOFMONTH' | translate}}">
                            <mat-datepicker-toggle matSuffix [for]="begu_start"></mat-datepicker-toggle>
                            <mat-datepicker #begu_start></mat-datepicker>
                            <dv-error-messages input-id="begu_start_ID"
                                               [errorObject]="bgStartDate.errors">
                            </dv-error-messages>
                        </div>

                        <mat-checkbox id="angebotTS" name="angebotTS"
                                      [disabled]="!(isSuperadminOrMandant())"
                                      [(ngModel)]="stammdaten.gemeinde.angebotTS" *ngIf="tageschuleEnabledForMandant">
                            {{'GEMEINDE_ANGEBOT_TAGESSCHULE'|translate}}</mat-checkbox>

                        <mat-checkbox id="angebotFI" name="angebotFI"
                                      [(ngModel)]="stammdaten.gemeinde.angebotFI" *ngIf="tageschuleEnabledForMandant">
                            {{'GEMEINDE_ANGEBOT_FERIENINSEL'|translate}}</mat-checkbox>

                        <div class="dv-error-messages" *ngIf="showMessageKeinAngebotSelected">
                            <span>{{'GEMEINDE_ANGEBOT_EMPTY_SELECTION' | translate}}</span>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-sm-6">
                    <h3 translate for="korrespondenzsprache_id">BANKVERBINDUNG</h3>
                    <!-- Kontoinhaber -->
                    <div class="form-group">
                        <label class="required" translate for="kontoinhaber_id">KONTO_INHABER</label>
                        <input id="kontoinhaber_id" type="text"
                               name="kontoinhaber_id" #nameKontoinhaber="ngModel"
                               required
                               [(ngModel)]="stammdaten.kontoinhaber"
                               [maxlength]="255" class="form-control">
                        <dv-error-messages [errorObject]="nameKontoinhaber.errors"
                                           inputId="kontoinhaber_id"></dv-error-messages>
                    </div>
                    <!-- BIC/SWIFT-Nummer -->
                    <div class="form-group">
                        <label class="required" translate for="bic_id">BIC_SWIFT_NUMMER</label>
                        <input id="bic_id" type="text"
                               name="bic_id" #nameBIC="ngModel"
                               required
                               [(ngModel)]="stammdaten.bic"
                               [maxlength]="255" class="form-control">
                        <dv-error-messages [errorObject]="nameBIC.errors"
                                           inputId="bic_id"></dv-error-messages>
                    </div>
                    <!-- IBAN-Nummer -->
                    <div class="form-group">
                        <label class="required" translate for="iban_id">IBAN_NUMMER</label>
                        <input id="iban_id" type="text"
                               name="iban_id" #nameIBAN="ngModel"
                               required ngxIban
                               [(ngModel)]="stammdaten.iban"
                               [maxlength]="255" class="form-control">
                        <dv-error-messages [errorObject]="nameIBAN.errors"
                                           inputId="iban_id"></dv-error-messages>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>

    <ng-template #viewModeTemplate>
        <fieldset>
            <div class="row">
                <!-- Kontaktadresse -->
                <div class="col-sm-3">
                    <div class="form-group">
                        <h3 translate>KONTAKTADRESSE</h3>
                        <p>{{stammdaten.adresse.organisation}}</p>
                        <p>{{stammdaten.adresse.strasse}} {{stammdaten.adresse.hausnummer}}</p>
                        <p>{{stammdaten.adresse.plz}} {{stammdaten.adresse.ort}}</p>
                    </div>
                </div>
                <!-- E-Mail, Telefon -->
                <div class="col-sm-3">
                    <div class="form-group">
                        <h3>&nbsp;</h3>
                        <p><a href="mailto:{{stammdaten.mail}}">{{stammdaten.mail}}</a></p>
                        <p><a href="tel:{{stammdaten.telefon}}">{{stammdaten.telefon}}</a></p>
                        <p><a href="{{stammdaten.webseite}}" target="tah">{{stammdaten.webseite}}</a></p>
                    </div>
                </div>
                <!-- Angebot -->
                <div class="col-sm-3">
                    <div class="form-group">
                        <h3 translate>GEMEINDE_ANGEBOT</h3>
                        <p *ngIf="stammdaten.gemeinde.angebotBG" translate>GEMEINDE_ANGEBOT_BETREUUNGSGUTSCHEINE</p>
                        <p *ngIf="stammdaten.gemeinde.angebotTS" translate>GEMEINDE_ANGEBOT_TAGESSCHULE</p>
                        <p *ngIf="stammdaten.gemeinde.angebotFI" translate>GEMEINDE_ANGEBOT_FERIENINSEL</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- Standardverantwortliche -->
                <div *ngIf="stammdaten.defaultBenutzer" class="col-sm-6">
                    <div class="form-group">
                        <h3 translate>STANDARD_VERANTWORTLICHE</h3>
                        <p>{{stammdaten.defaultBenutzer.vorname}} {{stammdaten.defaultBenutzer.nachname}}</p>
                    </div>
                </div>
                <!-- Korrespondenzsprache -->
                <div class="col-sm-6">
                    <div class="form-group">
                        <h3 translate>KORRESPONDENZSPRACHE</h3>
                        <p>{{korrespondenzsprache}}</p>
                    </div>
                </div>
                <div class="col-sm-6">
                    <!-- BANKVERBINDUNG -->
                    <div class="form-group">
                        <h3 translate>BANKVERBINDUNG</h3>
                        <p>{{stammdaten.kontoinhaber}}</p>
                        <p>{{stammdaten.bic}}</p>
                        <p>{{stammdaten.iban}}</p>
                    </div>
                </div>
                <!-- Beschwerdeadresse -->
                <div *ngIf="stammdaten.standardRechtsmittelbelehrung; else displayRechtsmittelbelehrung">
                    <div *ngIf="keineBeschwerdeAdresse; else displayBeschwerdeAdresse" class="col-sm-6">
                        <div class="form-group">
                            <h3 translate>BESCHWERDE_ADRESSE</h3>
                            <p translate>BESCHWERDE_ADRESSE_IDENTISCH_KONTAKT</p>
                        </div>
                    </div>
                    <ng-template #displayBeschwerdeAdresse>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <h3 translate>BESCHWERDE_ADRESSE</h3>
                                <p>{{stammdaten.beschwerdeAdresse.organisation}}</p>
                                <p>{{stammdaten.beschwerdeAdresse.strasse}}
                                    {{stammdaten.beschwerdeAdresse.hausnummer}}</p>
                                <p>{{stammdaten.beschwerdeAdresse.plz}} {{stammdaten.beschwerdeAdresse.ort}}</p>
                            </div>
                        </div>
                    </ng-template>
                </div>
                <ng-template #displayRechtsmittelbelehrung>
                    <div class="col-sm-6">
                        <div class="form-group">
                            <h3 translate>RECHTSMITTELBELEHRUNG_TEXT_DE</h3>
                            <p>{{stammdaten.rechtsmittelbelehrung.textDeutsch}}</p>
                            <h3 translate>RECHTSMITTELBELEHRUNG_TEXT_FR</h3>
                            <p>{{stammdaten.rechtsmittelbelehrung.textFranzoesisch}}</p>
                        </div>
                    </div>
                </ng-template>
            </div>
        </fieldset>
    </ng-template>
</div>

