<!--
  ~ Copyright (C) 2023 DV Bern AG, Switzerland
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program. If not, see <https://www.gnu.org/licenses/>.
  -->

<div class="betreuung-view gesuch-modul static-position">
    <h1 class="access-for-all-title" data-translate="AFA_GESUCHSFORMULAR"></h1>

    <div class="row view-title">
        <div class="col-md-8">
            <h2>
                <!--eventuell nummer noch anders lesen per methode-->
                <span data-translate="BETREUUNGSANGEBOT_NUMBER"
                      data-translate-value-geburtsdatum="{{vm.getKindModel().kindJA.geburtsdatum | amDateFormat : 'DD.MM.YYYY'}}"
                      data-translate-value-geschlecht="{{vm.getKindModel().kindJA.geschlecht | translate}}"
                      data-translate-value-kindname="{{vm.getKindModel().kindJA.getFullName()}}"></span>
            </h2>
            <dv-bisher gs="vm.getErweiterteBetreuungGS()"
                       ja="vm.getErweiterteBetreuungJA()"
                       show-specific-bisher-text-if-bisher-none="true"
                       specific-bisher-text="'DURCH_GEMEINDE_ERFASST' | translate"></dv-bisher>
        </div>
        <div class="col-md-4 text-right">
            <h2 aria-hidden class="ebegu-h2">
                {{ vm.model.bgNummer }}
            </h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <hr class="header"/>
        </div>
    </div>


    <div class="row margin-top-40">
        <div class="col-md-12">
            <form class="" name="vm.form" novalidate role="form"
                  unsaved-warning-form>

                <!-- Nur fuer Institutionen/Traegerschaften eingeblendet-->
                <div dv-show-allowed-roles="vm.TSRoleUtil.getRolesForBetreuungenView()" dv-show-element>
                    <!--Fachstelle-->
                    <div ng-if="vm.getKindModel().hasPensumFachstelle() && !vm.isFachstellenTypLuzern()">
                        <ng-container ng-repeat="pensumFachstelle in vm.getKindModel().kindJA.pensumFachstellen">
                            <div class="row" ng-if="vm.getFachstellenList().length > 0 ">
                                <div class="col-sm-12 dv-input-container-medium form-group">
                                    <label class="md-no-float" data-translate="FACHSTELLE"></label>
                                    <input class="form-control" data-test="fachstelle-id" id="fachstelle_ID" name="fachstelle"
                                           ng-disabled="true"
                                           ng-value="pensumFachstelle.fachstelle.name | translate"
                                           type="text">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12 dv-input-container-small form-group">
                                    <label class="md-no-float" data-translate="BETREUUNGSPENSUM_FACHSTELLE"></label>
                                    <input class="form-control" data-test="pensum-fachstelle-id" id="pensumFachstelle_ID"
                                           name="pensumFachstelle"
                                           ng-disabled="true"
                                           ng-value="pensumFachstelle.pensum"
                                           type="text">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6 dv-input-container-small form-group">
                                    <label class="md-no-float" data-translate="VON"></label>
                                    <input class="form-control" data-test="pensum-fachstelle-gueltig-ab"
                                           id="pensumFachstelleGueltigAb_ID"
                                           name="pensumFachstelleGueltigAb"
                                           ng-disabled="true"
                                           ng-value="pensumFachstelle.gueltigkeit.gueltigAb | amDateFormat : 'DD.MM.YYYY'"
                                           type="text">
                                </div>
                                <div class="col-sm-6 dv-input-container-small form-group">
                                    <label class="md-no-float" data-translate="BIS"></label>
                                    <input class="form-control" data-test="pensum-fachstelle-gueltig-bis"
                                           id="pensumFachstelleGueltigBis_ID"
                                           name="pensumFachstelleGueltigBis"
                                           ng-disabled="true"
                                           ng-value="pensumFachstelle.gueltigkeit.gueltigBis | amDateFormat : 'DD.MM.YYYY'"
                                           type="text">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6 margin-top-20 margin-bottom-50">
                                    <hr class="header"/>
                                </div>
                            </div>
                        </ng-container>

                        <dv-demo-feature-wrapper [demo-feature]="vm.demoFeature">
                            <div class="row margin-bottom-50" ng-if="vm.showPensumUnterschrittenCheckBox()">
                                <div class="col-xs-12 dv-input-container-question">
                                    <div class="checkbox">
                                        <md-checkbox
                                            aria-label="{{'ANSPRUCH_FACHSTELLE_WENN_PENSUM_UNTERSCHRITTEN'|translate}}"
                                            dv-enable-allowed-roles="vm.allowedRoles"
                                            dv-enable-element
                                            dv-enable-expression="vm.enableFieldsEditedByGemeinde()"
                                            name="anspruchFachstelleWennPensumUnterschritten"
                                            ng-model="vm.getErweiterteBetreuungJA().anspruchFachstelleWennPensumUnterschritten">
                                            <span data-translate="ANSPRUCH_FACHSTELLE_WENN_PENSUM_UNTERSCHRITTEN"></span>
                                        </md-checkbox>
                                        <dv-tooltip input-id="niedrigesBetreuungspensum"
                                                    text="'NIEDRIGES_BETREUUNGSPENSUM' | translate"></dv-tooltip>
                                    </div>
                                </div>
                            </div>
                            <ng-container ng-if="!vm.showPensumUnterschrittenCheckBox()">
                                {{ vm.resetAnspruchFachstelleWennPensumUnterschritten() }}
                            </ng-container>
                        </dv-demo-feature-wrapper>
                    </div>
                </div>

                <fieldset>

                    <!--Betreuungsangebot (Mit diesem Wert filtern wir die Institutionen)-->
                    <div class="row"
                         ng-disabled="!vm.enableBetreuungsangebotsTyp()"
                         ng-if="vm.hasMandantZusaetzlichesBereuungsangebot()">
                        <div class="col-sm-12 dv-input-container-medium">
                            <div class="form-group">
                                <label class="md-no-float"
                                       for="betreuungsangebot">
                                    <span class="required" data-translate="BETREUUNGSANGEBOT_WAEHLEN"></span>
                                </label>
                                <div class="dv-select-style">
                                    <select aria-describedby="betreuungsangebot-error" class="form-control"
                                            data-test="betreuungsangebot"
                                            id="betreuungsangebot"
                                            name="betreuungsangebot"
                                            ng-change="vm.changedAngebot()"
                                            ng-disabled="!vm.isEnabled() || !vm.enableBetreuungsangebotsTyp()"
                                            ng-model="vm.betreuungsangebot"
                                            ng-options="betreuungsangebot as betreuungsangebot.value for betreuungsangebot in vm.betreuungsangebotValues"
                                            ng-required="true">
                                    </select>
                                    <dv-error-messages for="vm.form.betreuungsangebot.$error"
                                                       input-id="betreuungsangebot"></dv-error-messages>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Keine Detailangaben zur Anmeldung -->
                    <div class="row margin-bottom-20 margin-top-20"
                         dv-show-allowed-roles="vm.TSRoleUtil.getAdministratorOrAmtRole()"
                         dv-show-element
                         dv-show-expression="vm.isTagesschule() && vm.gesuchModelManager.getGesuchsperiode().hasTagesschulenAnmeldung()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="checkbox">
                                <md-checkbox aria-label="{{'ANMELDUNG_KEINE_DETAILINFORMATIONEN'|translate}}"
                                             data-test="keine-detailinformationen"
                                             name="keineDetailinformationen"
                                             ng-change="vm.keineDetailAnmeldungClicked()"
                                             ng-disabled="!vm.isEnabled()"
                                             ng-model="vm.getBetreuungModel().keineDetailinformationen">
                                    <span data-translate="ANMELDUNG_KEINE_DETAILINFORMATIONEN"></span>
                                </md-checkbox>
                            </div>
                        </div>
                    </div>

                    <!--vertrag radiogroup-->
                    <div class="row" ng-if="vm.isGesuchstellerSozialdienst() && !vm.isSchulamt()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="form-group">
                                <md-radio-group aria-label="{{vm.ariaLabel}}"
                                                class="radio"
                                                data-test="container.vertrag"
                                                dv-suppress-form-submit-on-enter
                                                ng-change="vm.onChangeVertrag()"
                                                ng-disabled="!vm.isEnabled()"
                                                ng-model="vm.getBetreuungModel().vertrag"
                                                ng-required="true">

                                    <md-radio-button aria-describedby="{{vm.ariaDescribedBy}}"
                                                     aria-label="{{'VERTRAG'| translate}}"
                                                     class="element-ja"
                                                     data-test="radio-value.ja"
                                                     ng-required="true"
                                                     ng-value="true">
                                        <span data-translate="VERTRAG"></span>
                                    </md-radio-button>
                                    <md-radio-button aria-describedby="{{vm.ariaDescribedBy}}"
                                                     aria-label="{{'KEIN_VERTRAG'| translate}}"
                                                     class="element-nein"
                                                     data-test="radio-value.nein"
                                                     ng-required="true"
                                                     ng-value="false">
                                        <span data-translate="KEIN_VERTRAG"></span>
                                    </md-radio-button>
                                </md-radio-group>
                            </div>
                        </div>
                    </div>

                    <!--provisorische Betreuung-->
                    <fieldset>
                        <div ng-if="vm.isProvisorischeBetreuung() && !vm.getBetreuungModel().keineDetailinformationen">

                            <dv-betreuung-input betreuung-input-switch-typ="vm.getBetreuungspensumAnzeigeTyp()"
                                                betreuungsangebot-typ="vm.betreuungsangebot.key"
                                                index="$index"
                                                input-id="provPensum"
                                                is-disabled="!vm.isEnabled()"
                                                is-luzern="vm.isLuzern"
                                                pensum-container="vm.getBetreuungspensum(0)">
                            </dv-betreuung-input>

                            <!--provisorische monatliche Betreuungskosten-->
                            <div class="row">
                                <div class="col-sm-12 dv-input-container-medium">
                                    <dv-input-container class="form-group">
                                        <label class="md-no-float"
                                               for="provMonatlicheBetreuungskosten">
                                            <span data-translate="GESCHAETZTE_MONATLICHE_BETREUUNGSKOSTEN"></span>
                                            <dv-tooltip input-id="provMonatlicheBetreuungskosten"
                                                        text="'GESCHAETZTE_MONATLICHE_BETREUUNGSKOSTEN_HELP' | translate"></dv-tooltip>
                                        </label>
                                        <div class="dv-input-container-medium-label">
                                            <input aria-describedby="provMonatlicheBetreuungskosten-error"
                                                   class="form-control" dv-max-length
                                                   id="provMonatlicheBetreuungskosten"
                                                   name="provMonatlicheBetreuungskosten"
                                                   ng-attr-placeholder="{{'BETRAG_PLACEHOLDER' | translate}}"
                                                   ng-disabled="!vm.isEnabled()"
                                                   ng-model="vm.getBetreuungspensum(0).betreuungspensumJA.monatlicheBetreuungskosten"
                                                   ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                                   ng-required="true"
                                                   type="number">
                                            <dv-error-messages for="vm.form['provMonatlicheBetreuungskosten'].$error"
                                                               input-id="provMonatlicheBetreuungskosten"></dv-error-messages>
                                        </div>

                                    </dv-input-container>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <!--Institutionen-->
                    <div ng-if="vm.getBetreuungModel().vertrag">
                        <!--Institutionen, wenn editable ist oder der status falsche institution ist, als liste anzeigen-->
                        <div class="row hide-sm hide-xs" id="institution_search" ng-if="vm.showInstitutionenList()">
                            <div class="col-sm-12 dv-input-container-medium form-group">
                                <label class="md-no-float required" data-translate="INSTITUTION" for="institution">
                                </label>
                                <md-autocomplete class="form-control"
                                                 data-test="institution"
                                                 flex
                                                 md-delay="0"
                                                 md-input-id="institution"
                                                 md-input-name="institution"
                                                 md-item-text="item.institution.name"
                                                 md-items="item in vm.querySearch(vm.searchQuery)"
                                                 md-match-case-insensitive="true"
                                                 md-menu-container-class="institution-autocomplete"
                                                 md-min-length="0"
                                                 md-no-cache="true"
                                                 md-require-match="true"
                                                 md-search-text="vm.searchQuery"
                                                 md-select-on-focus="true"
                                                 md-selected-item="vm.instStamm"
                                                 md-selected-item-change="vm.setSelectedInstitutionStammdaten()"
                                                 ng-attr-placeholder="{{'SUCHBEGRIFF_EINGEBEN' | translate}}"
                                                 ng-required="!vm.isInstitutionMobileSelection()">
                                    <md-item-template>
                                        <span data-test="instutions-suchtext" md-highlight-text="vm.searchQuery">
                                            {{ item.getAutocompleteText() }}
                                        </span>
                                    </md-item-template>
                                </md-autocomplete>
                                <span ng-if="vm.form.institution.$touched">
                                    <dv-error-messages for="vm.form.institution.$error"
                                                       input-id="institution"></dv-error-messages>
                                </span>
                            </div>
                        </div>
                        <div class="row hide-gt-sm"
                             ng-if="vm.showInstitutionenList()">
                            <div class="col-sm-12 dv-input-container-medium form-group">
                                <label class="md-no-float required" data-translate="INSTITUTION" for="institution_mobile">
                                </label>
                                <div class="dv-select-style">
                                    <select aria-describedby="institution-error" class="form-control"
                                            data-test="institution-mobile"
                                            id="institution_mobile"
                                            name="institution"
                                            ng-change="vm.setSelectedInstitutionStammdaten()"
                                            ng-disabled="!(vm.isEnabled() || vm.isFalscheInstitutionAndUserInRole())"
                                            ng-model="vm.instStamm"
                                            ng-options="institutionSD as institutionSD.institution.name for institutionSD in vm.getInstitutionenSDList() | orderBy: 'institution.name'"
                                            ng-required="vm.isInstitutionMobileSelection()">
                                    </select>
                                </div>
                                <span ng-if="vm.form.institution.$touched">
                                    <dv-error-messages for="vm.form.institution.$error"
                                                       input-id="institution_mobile"></dv-error-messages>
                                </span>
                            </div>
                        </div>
                        <!-- Institiutionen wenn readonly als Textfeld anzeigen-->
                        <div class="row" ng-if="vm.showInstitutionenAsText()">
                            <div class="col-sm-12 dv-input-container-medium form-group">
                                <label class="md-no-float" data-translate="INSTITUTION" for="institution">
                                </label>
                                <input aria-describedby="institutioninput-error"
                                       class="form-control"
                                       id="institutioninput"
                                       name="institution"
                                       ng-disabled="!vm.isEnabled()"
                                       ng-model="vm.getInstitutionSD().institution.name"
                                       ng-required="true"
                                       type="text">
                                <dv-error-messages class="error" for="vm.form.institutioninput.$error"
                                                   input-id="institutioninput"></dv-error-messages>
                            </div>
                        </div>
                        <div class="row" ng-if="vm.getInstitutionNotFoundHint()">
                            <div class="col-xs-12 margin-bottom-50">
                                <p ng-bind-html="vm.getInstitutionNotFoundHint()"></p>
                            </div>
                        </div>
                    </div>

                    <!--Kesb Platzierung-->
                    <div class="row"
                         dv-show-allowed-roles="vm.TSRoleUtil.getAllRolesButTraegerschaftInstitution()"
                         dv-show-element
                         dv-show-expression="!vm.isSchulamt() && !vm.hideKesbPlatzierung">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="form-group">
                                <span class="ebegu-h1 required">
                                    <span data-translate="KEINE_KESB_PLATZIERUNG"></span>
                                </span>

                                <dv-radio-container aria-described-by="keineKesbPlatzierung-error"
                                                    aria-label="{{'KEINE_KESB_PLATZIERUNG'|translate}}"
                                                    class="input-element"
                                                    data-test="is-kesb-platzierung"
                                                    dv-enable-allowed-roles="vm.allowedRoles"
                                                    dv-enable-element
                                                    dv-enable-expression="vm.enableFieldsEditedByGemeinde()"
                                                    name="keineKesbPlatzierung"
                                                    ng-change="vm.changeKeineKesbPlatzierung()"
                                                    ng-model="vm.isKesbPlatzierung"
                                                    ng-required="true">
                                </dv-radio-container>
                                <dv-error-messages class="error"
                                                   for="vm.form.keineKesbPlatzierung.$error"
                                                   input-id="keineKesbPlatzierung"></dv-error-messages>
                                <dv-bisher gs="vm.getErweiterteBetreuungGS().keineKesbPlatzierung"
                                           ja="vm.getErweiterteBetreuungJA().keineKesbPlatzierung"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getErweiterteBetreuungGS())"></dv-bisher>
                            </div>
                        </div>
                    </div>

                    <!--erweiterte Beduerfnisse-->
                    <div class="row" ng-if="vm.showErweiterteBeduerfnisse() && !vm.isSchulamt()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="form-group">
                                <span class="ebegu-h1 required">
                                    <span data-translate="ERWEITERTE_BEDUERFNISSE"></span>
                                    <dv-tooltip ng-if="('ERWEITERTE_BEDUERFNISSE_HINT' | translate).length > 0"
                                                text="'ERWEITERTE_BEDUERFNISSE_HINT' | translate"></dv-tooltip>
                                </span>

                                <dv-radio-container aria-described-by="erweiterteBeduerfnisse-error"
                                                    aria-label="{{'ERWEITERTE_BEDUERFNISSE'|translate}}"
                                                    class="input-element"
                                                    data-test="erweiterte-beduerfnisse"
                                                    dv-enable-allowed-roles="vm.allowedRoles"
                                                    dv-enable-element
                                                    dv-enable-expression="vm.enableFieldsEditedByGemeinde()"
                                                    name="erweiterteBeduerfnisse"
                                                    ng-change="vm.changedBesondereBeduerfnisse()"
                                                    ng-model="vm.getErweiterteBetreuungJA().erweiterteBeduerfnisse"
                                                    ng-required="true">
                                </dv-radio-container>
                                <dv-error-messages class="error"
                                                   for="vm.form.erweiterteBeduerfnisse.$error"
                                                   input-id="erweiterteBeduerfnisse"></dv-error-messages>
                                <dv-bisher gs="vm.getErweiterteBetreuungGS().erweiterteBeduerfnisse"
                                           ja="vm.getErweiterteBetreuungJA().erweiterteBeduerfnisse"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getErweiterteBetreuungGS())"
                                           specific-bisher-text="vm.getTextFachstelleKorrekturJA()"></dv-bisher>
                            </div>
                        </div>
                    </div>

                    <!--Fachstelle erweiterte Beduerfnisse-->
                    <div ng-if="vm.isFachstelleRequired()">
                        <div class="row" ng-if="vm.getFachstellenList().length">
                            <div class="col-sm-12 dv-input-container-medium form-group">
                                <label class="md-no-float required" for="fachstelle">
                                    <span data-translate="FACHSTELLE"></span>
                                    <dv-tooltip text="'ERWEITERTE_BEDUERFNISSE_FACHSTELLE_HINT' | translate"></dv-tooltip>
                                </label>
                                <div class="dv-select-style">
                                    <select aria-describedby="fachstelle-error"
                                            class="form-control"
                                            data-test="fachstelle"
                                            id="fachstelle"
                                            name="fachstelle"
                                            ng-change="vm.setSelectedFachsstelle()"
                                            ng-disabled="!vm.enableFieldsEditedByGemeinde()"
                                            ng-model="vm.fachstelleId"
                                            ng-options="fachstelle.id as fachstelle.name | translate for fachstelle in vm.getFachstellenList() | orderBy: 'name'"
                                            ng-required="vm.isFachstelleRequired()">
                                    </select>
                                    <dv-bisher gs="vm.getErweiterteBetreuungGS().fachstelle.name"
                                               ja="vm.getErweiterteBetreuungJA().fachstelle.name"
                                               show-if-bisher-none="vm.isNotNullOrUndefined(vm.getErweiterteBetreuungGS())"></dv-bisher>
                                    <dv-error-messages class="error" for="vm.form.fachstelle.$error"
                                                       input-id="fachstelle"></dv-error-messages>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Bestätigung Ausserordentlicher Betreuungsaufwand-->
                    <div dv-show-allowed-roles="vm.TSRoleUtil.getAllRolesButGesuchstellerSozialdienst()"
                         dv-show-element
                         dv-show-expression="vm.isFachstelleRequired()">
                        <!--ausserodentlicher Betreuungsaufwand bestätigen -->
                        <div class="row">
                            <div class="col-xs-12 dv-input-container-question form-group">
                                <div class="checkbox">
                                    <md-checkbox aria-label="vm.getErweiterteBeduerfnisseBestaetigtLabel()"
                                                 data-test="erweiterte-beduerfnisse-bestaetigt"
                                                 name="erweiterteBeduerfnisseBestaetigt"
                                                 ng-disabled="!vm.isBestaetigungBesondereBeduerfnisseEnabled()"
                                                 ng-model="vm.getErweiterteBetreuungJA().erweiterteBeduerfnisseBestaetigt">
                                        <span>{{ vm.getErweiterteBeduerfnisseBestaetigtLabel() }}</span>
                                    </md-checkbox>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <!--ausserodentlicher Betreuungsaufwand Betrag konfigurierbar-->
                            <div class="col-xs-12 dv-input-container-question"
                                 ng-if="vm.isBesondereBeduerfnisseAufwandVisible()">
                                <dv-input-container class="form-group">
                                    <label class="md-no-float required" data-translate="BESONDERE_BEDUERFNISSE_BETRAG"
                                           for="besondereBeduerfnisseAufwand"></label>
                                    <div class="dv-input-container-small">
                                        <input
                                            aria-describedby="besondereBeduerfnisseAufwand-error"
                                            class="form-control"
                                            data-test="besondere-beduerfnisse-aufwand" dv-max-length
                                            id="besondereBeduerfnisseAufwand"
                                            ng-attr-placeholder="{{'BETRAG_PLACEHOLDER' | translate}}"
                                            ng-disabled="!vm.enableFieldsEditedByGemeinde()"
                                            ng-model="vm.getErweiterteBetreuungJA().erweitereteBeduerfnisseBetrag"
                                            ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                            ng-required="true"
                                            type="number">
                                        <dv-error-messages class="error"
                                                           for="vm.form.besondereBeduerfnisseAufwand.$error"
                                                           input-id="besondereBeduerfnisseAufwand"></dv-error-messages>
                                    </div>
                                </dv-input-container>
                            </div>
                        </div>
                    </div>

                    <!--kitaPlus Zuschlag für besondere Beduerfnisse-->
                    <div class="row" ng-if="vm.showKitaPlusZuschlag()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="form-group">
                                <span class="ebegu-h1 required">
                                    <span data-translate="BESONDERE_BEDUERFNISSE_KITA_PLUS_ZUSCHLAG"></span>
                                    <dv-tooltip text="'BESONDERE_BEDUERFNISSE_KITA_PLUS_ZUSCHLAG_HINT' | translate"></dv-tooltip>
                                </span>

                                <dv-radio-container aria-described-by="kitaPlusZuschlag-error"
                                                    aria-label="{{'BESONDERE_BEDUERFNISSE_KITA_PLUS_ZUSCHLAG'|translate}}"
                                                    class="input-element"
                                                    data-test="kita-plus-zuschlag"
                                                    dv-enable-allowed-roles="vm.allowedRoles"
                                                    dv-enable-element
                                                    dv-enable-expression="vm.isBetreuungsstatusAusstehend() || vm.isBetreuungsstatusWarten()"
                                                    name="kitaPlusZuschlag"
                                                    ng-model="vm.getErweiterteBetreuungJA().kitaPlusZuschlag"
                                                    ng-required="true">
                                </dv-radio-container>
                                <dv-error-messages class="error"
                                                   for="vm.form.kitaPlusZuschlag.$error"
                                                   input-id="kitaPlusZuschlag"></dv-error-messages>
                                <dv-bisher gs="vm.getErweiterteBetreuungGS().kitaPlusZuschlag"
                                           ja="vm.getErweiterteBetreuungJA().kitaPlusZuschlag"
                                           show-if-bisher-none="vm.isNotNullOrUndefined(vm.getErweiterteBetreuungGS())"></dv-bisher>
                            </div>
                        </div>
                    </div>
                    <!--Bestätigung Ausserordentlicher Betreuungsaufwand-->
                    <div dv-show-allowed-roles="vm.TSRoleUtil.getAllRolesButGesuchstellerSozialdienst()"
                         dv-show-element
                         dv-show-expression="vm.isKitaPlus()">
                        <!--ausserodentlicher Betreuungsaufwand bestätigen -->
                        <div class="row">
                            <div class="col-xs-12 dv-input-container-question form-group">
                                <div class="checkbox">
                                    <md-checkbox
                                        aria-label="{{'BESONDERE_BEDUERFNISSE_KITA_PLUS_ZUSCHLAG_BESTAETIGUNG' | translate}}"
                                        data-test="kita-plus-zuschlag-bestaetigt"
                                        name="kitaPlusZuschlagBestaetigt"
                                        ng-disabled="!vm.isBestaetigungBesondereBeduerfnisseEnabled() || !vm.isBetreuungsstatusWarten()"
                                        ng-model="vm.getErweiterteBetreuungJA().kitaPlusZuschlagBestaetigt">
                                        <span>{{ 'BESONDERE_BEDUERFNISSE_KITA_PLUS_ZUSCHLAG_BESTAETIGUNG' | translate }}</span>
                                    </md-checkbox>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" ng-if="vm.auszahlungAnEltern">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="form-group">
                                 <span class="ebegu-h1 required">
                                    <span data-translate="ABRECHNUNG_DER_GUTSCHEINE"></span>
                                </span>
                                <dv-radio-container aria-described-by="abrechnungGutscheine-error"
                                                    aria-label="{{'ABRECHNUNG_DER_GUTSCHEINE'|translate}}"
                                                    class="input-element"
                                                    data-test="abrechnung-gutscheine"
                                                    dv-enable-element
                                                    dv-enable-expression="vm.showAbrechnungGutscheine()"
                                                    false-option-label="{{'UEBER_INSTITUTION' | translate}}"
                                                    id="abrechnungGutscheine"
                                                    name="abrechnungGutscheine"
                                                    ng-change="vm.onChangeAbrechnungGutscheine()"
                                                    ng-model="vm.getBetreuungModel().auszahlungAnEltern"
                                                    ng-required="true"
                                                    true-option-label="{{'UEBER_ELTERN' | translate}}">
                                    <dv-error-messages class="error"
                                                       for="vm.form.abrechnungGutscheine.$error"
                                                       input-id="abrechnungGutscheine">
                                    </dv-error-messages>
                                </dv-radio-container>
                            </div>
                        </div>

                        <!-- Begründung wenn Auszahlung an Institution -->
                        <div class="row form-group margin-bottom-20" ng-if="vm.showAuszahlungAnInstituion()">
                            <div class="col-xs-12">
                                <span class="ebegu-h1 required">
                                    <span data-translate="BEGRUENDUNG_AUSZAHLUNG_AN_INSTITUTION"></span>
                                </span>
                            </div>
                            <div class="col-xs-12 col-md-6">
                                <textarea
                                    class="form-control"
                                    data-test="begruendung-auszahlung-institution"
                                    dv-enable-element
                                    id="begruendungAuszahlungInstitution"
                                    maxlength="4000"
                                    ng-disabled="!vm.showAbrechnungGutscheine()"
                                    ng-model="vm.getBetreuungModel().begruendungAuszahlungAnInstitution"
                                    ng-required="true"
                                    rows="10"></textarea>
                                <dv-error-messages class="error"
                                                   for="vm.form.begruendungAuszahlungInstitution.$error"
                                                   input-id="begruendungAuszahlungInstitution">
                                </dv-error-messages>
                            </div>
                        </div>
                    </div>

                    <div class="row form-group margin-bottom-20"
                         ng-if="vm.hoehereBeitraegeWegenBeeintraechtigungBeantragt && vm.isHoehereBeitraegeEinstellungAktiviert">

                        <div class="well well-status-warten">
                            {{ 'HOEHERE_BEITRAEGE_BEEINTRAECHTIGUNG_BEANTRAGT'| translate }}

                        </div>
                    </div>

                    <!--Eingewoehnung Periode-->
                    <div class="row" ng-if="vm.showEingewoehnungPeriode()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="checkbox">
                                <md-checkbox aria-label="{{'EINGEWOEHNUNG'| translate}}"
                                             data-test="eingewoehnung"
                                             id="eingewoehnung"
                                             name="eingewoehnung"
                                             ng-disabled="!vm.isEingewoehnungPeriodeEnabled()"
                                             ng-model="vm.getBetreuungModel().eingewoehnung">
                                    <span>{{ vm.getEingewoehnungLabel() }}</span>
                                </md-checkbox>
                                <dv-tooltip input-id="eingewoehnung"
                                            text="'EINGEWOEHNUNG_HELP' | translate"></dv-tooltip>
                            </div>
                        </div>
                    </div>

                    <!-- Sprachfoerderung Bestaetigen -->
                    <div class="row margin-bottom-50" ng-if="vm.showSprachfoerderungBestaetigenCheckBox()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="checkbox">
                                <md-checkbox
                                    aria-label="{{vm.isKita() ? 'SPRACHFOERDERUNG_BESTAETIGEN_KITA' : 'SPRACHFOERDERUNG_BESTAETIGEN_TFO' |translate}}"
                                    dv-enable-element
                                    name="sprachfoerderungBestaetigt"
                                    ng-disabled="!vm.isSprachfoerderungBestaetigenEnabled()"
                                    ng-model="vm.getErweiterteBetreuungJA().sprachfoerderungBestaetigt">
                                    <span
                                        data-translate="{{vm.isKita() ? 'SPRACHFOERDERUNG_BESTAETIGEN_KITA' : 'SPRACHFOERDERUNG_BESTAETIGEN_TFO'}}"></span>
                                </md-checkbox>
                            </div>
                        </div>
                    </div>

                    <!--Betreuung in Gemeinde-->
                    <div class="row"
                         dv-show-allowed-roles="vm.TSRoleUtil.getAllRolesButGesuchstellerSozialdienst()"
                         dv-show-element
                         dv-show-expression="vm.isBetreuungInGemeindeRequired()">
                        <div class="col-xs-12 dv-input-container-question">
                            <div class="checkbox">
                                <md-checkbox aria-label="{{vm.getBetreuungInGemeindeLabel()}}"
                                             data-test="betreuung-in-gemeinde"
                                             dv-enable-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                                             dv-enable-element
                                             dv-enable-expression="vm.isBetreuungsstatusWarten()"
                                             name="betreuungInGemeinde"
                                             ng-model="vm.getErweiterteBetreuungJA().betreuungInGemeinde">
                                    <span>{{ vm.getBetreuungInGemeindeLabel() }}</span>
                                </md-checkbox>
                            </div>
                        </div>
                    </div>

                </fieldset>

                <fieldset ng-disabled="vm.isGesuchReadonly() && !vm.isMutationsmeldungStatus">
                    <!--Diese Felder werden fuer Betreuungsangebottyp TAGESSCHULE ausgeblendet. Fuer alle anderen eingeblendet-->
                    <!--Nur Institutionen duerfen neue Pensen eintragen. Bei anderen Rollen werden nur die existierenden Pensen angezeigt-->
                    <div class="margin-top-20" ng-if="!vm.isSchulamt()">

                        <div class="row" dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionOnlyRoles()"
                             dv-show-element
                             dv-show-expression="vm.showExistingBetreuungsmitteilungInfoBox()">
                            <div class="col-md-6">
                                <div class="box-existing-mutationsmeldung">
                                    <i aria-hidden="true" class="fa fa-exclamation"></i>
                                    <a data-translate="EXISTING_MUTATIONSMELDUNG"
                                       data-translate-value-datum-mutationsmeldung="{{vm.getDatumLastBetreuungsmitteilung()}}"
                                       data-translate-value-time-mutationsmeldung="{{vm.getTimeLastBetreuungsmitteilung()}}"
                                       href=""
                                       ng-click="vm.openExistingBetreuungsmitteilung()"></a>
                                </div>
                            </div>
                        </div>

                        <div ng-if="!vm.isProvisorischeBetreuung()">
                            <fieldset dv-enable-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                                      dv-enable-element
                                      dv-enable-expression="vm.isPensumEditable()">

                                <p class="inline-hint" data-translate="BETREUUNG_HINT_UNTERMONATLICH"
                                   ng-show="vm.showHintUntermonatlich()"></p>

                                <p class="inline-hint eingewoehnung-hint" ng-show="vm.showHintEingewoehnung()">
                                    <span translate>BETREUUNG_HINT_EINGEWOEHNUNG</span>
                                    <dv-tooltip text="'BETREUUNG_HINT_EINGEWOEHNUNG_HELP' | translate"></dv-tooltip>
                                </p>

                                <!--Betreuungspensen-->
                                <div ng-repeat="betpen in vm.getBetreuungspensen()">
                                    <!--Schulergaenzende Betreuung-->
                                    <div class="row" ng-if="vm.showSchulergaezendeBetreuungFrage()">
                                        <div class="col-sm-6 dv-input-container-question">
                                            <dv-input-container class="form-group">
                                                <span class="ebegu-h1 required">
                                                    <span data-translate="SCHULERGAENZENDE_BETREUUNG_FRAGE"></span>
                                                </span>

                                                <dv-radio-container aria-described-by="schulergaezendeBetreuung-{{$index}}-error"
                                                                    aria-label="{{'SCHULERGAENZENDE_BETREUUNG_FRAGE'|translate}}"
                                                                    class="input-element"
                                                                    data-test="schulergaezende-betreuung-{{$index}}"
                                                                    dv-enable-element
                                                                    dv-enable-expression="vm.isSchulergaezendeBetreuungEnabled()"
                                                                    name="schulergaezendeBetreuung-{{$index}}"
                                                                    ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.betreuungInFerienzeit"
                                                                    ng-required="true"
                                                >
                                                </dv-radio-container>
                                                <dv-error-messages class="error"
                                                                   for="vm.form['schulergaezendeBetreuung-' + $index].$error"
                                                                   input-id="schulergaezendeBetreuung-{{$index}}"></dv-error-messages>
                                            </dv-input-container>
                                        </div>
                                    </div>


                                    <!--Betreuungspensum-->
                                    <div ng-if="vm.showBetreuungsPensumInput()">
                                        <dv-betreuung-input betreuung-input-switch-typ="vm.getBetreuungspensumAnzeigeTyp()"
                                                            betreuungsangebot-typ="vm.getBetreuungModel().getAngebotTyp()"
                                                            index="$index"
                                                            input-id="betreuungspensum-{{$index}}"
                                                            is-disabled="!vm.isPensumEditable()"
                                                            is-luzern="vm.isLuzern"
                                                            multiplier-kita="vm.getMultiplierKita()"
                                                            multiplier-tfo="vm.getMultiplierTFO()"
                                                            pensum-container="vm.getBetreuungspensum($index)">
                                        </dv-betreuung-input>
                                    </div>
                                    <!--Monatliche Betreuungskosten-->
                                    <div class="row" ng-if="vm.showAnwesenheitstageProMonatInput()">
                                        <div class="col-sm-12 dv-input-container-medium">
                                            <dv-input-container class="form-group">
                                                <label class="md-no-float"
                                                       for="monatlicheAnwesenheitstage-{{$index}}">
                                                    <span data-translate="ANWESENHEITSTAGE_PRO_MONAT"></span>
                                                    <dv-tooltip input-id="monatlicheAnwesenheitstage-{{$index}}"
                                                                text="'ANWESENHEITSTAGE_PRO_MONAT_HELP' | translate"></dv-tooltip>
                                                </label>
                                                <div class="dv-input-container-medium-label">
                                                    <input
                                                        aria-describedby="monatlicheAnwesenheitstage-{{$index}}-error"
                                                        class="form-control" dv-max-length
                                                        id="monatlicheAnwesenheitstage-{{$index}}"
                                                        max="28.7"
                                                        min="1" name="monatlicheAnwesenheitstage-{{$index}}"
                                                        ng-attr-data-test="monatliche-anwesenheitstage#{{$index}}"
                                                        ng-attr-placeholder="{{'TAGE_PLACEHOLDER' | translate}}"
                                                        ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.betreuteTage"
                                                        ng-pattern="vm.CONSTANTS.PATTERN_ONE_DECIMALS"
                                                        ng-required="true"
                                                        type="number">
                                                    <dv-error-messages
                                                        for="vm.form['monatlicheAnwesenheitstage-' + $index].$error"
                                                        input-id="monatlicheAnwesenheitstage-{{$index}}"></dv-error-messages>
                                                </div>

                                            </dv-input-container>
                                        </div>
                                    </div>

                                    <!--Monatliche Betreuungskosten-->
                                    <div class="row" ng-if="vm.showBetreuungsKostenInput()">
                                        <div class="col-sm-12 dv-input-container-medium">
                                            <dv-input-container class="form-group">
                                                <label class="md-no-float"
                                                       for="monatlicheBetreuungskosten-{{$index}}">
                                                    <span data-translate="{{vm.getMonatlicheBetreuungkostenKey()}}"></span>
                                                    <dv-tooltip input-id="monatlicheBetreuungskosten-{{$index}}"
                                                                text="vm.getMonatlicheBetreuungkostenHelpKey() | translate"></dv-tooltip>
                                                </label>
                                                <div class="dv-input-container-medium-label">
                                                    <input
                                                        aria-describedby="monatlicheBetreuungskosten-{{$index}}-error"
                                                        class="form-control" dv-max-length
                                                        id="monatlicheBetreuungskosten-{{$index}}"
                                                        name="monatlicheBetreuungskosten-{{$index}}"
                                                        ng-attr-data-test="monatliche-betreuungskosten#{{$index}}"
                                                        ng-attr-placeholder="{{'BETRAG_PLACEHOLDER' | translate}}"
                                                        ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.monatlicheBetreuungskosten"
                                                        ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                                        ng-required="true"
                                                        type="number"
                                                        type="number">
                                                    <dv-error-messages
                                                        for="vm.form['monatlicheBetreuungskosten-' + $index].$error"
                                                        input-id="monatlicheBetreuungskosten-{{$index}}"></dv-error-messages>
                                                </div>

                                            </dv-input-container>
                                        </div>
                                    </div>

                                    <!-- Mittagstisch -->
                                    <div ng-if="vm.isBetreuungsangebotMittagstisch()">
                                        <div class="row">
                                            <!-- Anzahl Mahlzeiten -->
                                            <div class="col-sm-12 dv-input-container-medium">
                                                <div class="form-group">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               for="monatlicheHauptmahlzeiten-{{$index}}">
                                                            <span data-translate="PENSUM_MAHLZEITEN"></span>
                                                            <dv-tooltip input-id="monatlicheHauptmahlzeiten-tooltip-{{$index}}"
                                                                        text="'PENSUM_MAHLZEITEN_HELP' | translate"></dv-tooltip>
                                                        </label>
                                                        <div class="dv-input-container-small" style="padding-right:32px;">
                                                            <input aria-describedby="monatlicheHauptmahlzeiten-{{$index}}-error"
                                                                   class="form-control"
                                                                   id="monatlicheHauptmahlzeiten-{{$index}}" min="0"
                                                                   name="monatlicheHauptmahlzeiten-{{$index}}"
                                                                   ng-attr-data-test="monatliche-hauptmahlzeiten#{{$index}}"
                                                                   ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.monatlicheHauptmahlzeiten"
                                                                   ng-required="true"
                                                                   step="0.01"
                                                                   type="number">
                                                            <dv-error-messages
                                                                for="vm.form['monatlicheHauptmahlzeiten-' + $index].$error"
                                                                input-id="monatlicheHauptmahlzeiten-{{$index}}"
                                                                step="0.01"></dv-error-messages>
                                                        </div>
                                                    </dv-input-container>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <!-- Kosten pro Mahlzeit -->
                                            <div class="col-sm-12 dv-input-container-medium">
                                                <dv-input-container class="form-group">
                                                    <label class="md-no-float"
                                                           for="kostenProMahlzeit-{{$index}}">
                                                        <span data-translate="KOSTEN_PRO_MAHLZEIT"></span>
                                                        <dv-tooltip input-id="kostenProMahlzeit-{{$index}}"
                                                                    text="'KOSTEN_PRO_MAHLZEIT_HELP' | translate"></dv-tooltip>
                                                    </label>
                                                    <div class="dv-input-container-medium-label">
                                                        <input
                                                            aria-describedby="kostenProMahlzeit-{{$index}}-error"
                                                            class="form-control" dv-max-length
                                                            id="kostenProMahlzeit-{{$index}}"
                                                            min="0"
                                                            name="kostenProMahlzeit-{{$index}}"
                                                            ng-attr-data-test="kosten-pro-mahlzeit#{{$index}}"
                                                            ng-attr-placeholder="{{'BETRAG_PLACEHOLDER' | translate}}"
                                                            ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.tarifProHauptmahlzeit"
                                                            ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                                            ng-required="true"
                                                            type="number">
                                                        <dv-error-messages for="vm.form['kostenProMahlzeit-' + $index].$error"
                                                                           input-id="kostenProMahlzeit-{{$index}}"></dv-error-messages>
                                                    </div>
                                                </dv-input-container>
                                            </div>
                                        </div>
                                    </div>

                                    <!--Stündliche Vollkosten (TFO)-->
                                    <div class="row" ng-if="vm.showStuendlicheKostenInput()">
                                        <div class="col-sm-12 dv-input-container-medium">
                                            <dv-input-container class="form-group">
                                                <label class="md-no-float"
                                                       for="stuendlicheKosten-{{$index}}">
                                                    <span data-translate="STUENDLICHE_VOLLKOSTEN"></span>
                                                </label>
                                                <div class="dv-input-container-medium-label">
                                                    <input
                                                        aria-describedby="stuendlicheKosten-{{$index}}-error"
                                                        class="form-control" dv-max-length
                                                        id="stuendlicheKosten-{{$index}}"
                                                        name="stuendlicheKosten-{{$index}}"
                                                        ng-attr-data-test="stuendliche-kosten#{{$index}}"
                                                        ng-attr-placeholder="{{'BETRAG_PLACEHOLDER' | translate}}"
                                                        ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.stuendlicheVollkosten"
                                                        ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                                        ng-required="true"
                                                        type="number">
                                                    <dv-error-messages for="vm.form['stuendlicheKosten-' + $index].$error"
                                                                       input-id="stuendlicheKosten-{{$index}}"></dv-error-messages>
                                                </div>

                                            </dv-input-container>
                                        </div>
                                    </div>

                                    <div ng-if="vm.isMahlzeitenverguenstigungActive()">
                                        <div class="row">
                                            <!-- monatlicheHauptmahlzeiten -->
                                            <div class="col-sm-12 dv-input-container-small">
                                                <div class="form-group">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               for="monatlicheHauptmahlzeiten-{{$index}}">
                                                            <span data-translate="MONATLICHE_HAUPTMAHLZEITEN"></span>
                                                            <dv-tooltip input-id="monatlicheHauptmahlzeiten-tooltip-{{$index}}"
                                                                        text="'MONATLICHE_HAUPTMAHLZEITEN_HELP' | translate"></dv-tooltip>
                                                        </label>
                                                        <div class="dv-input-container-small" style="padding-right:32px;">
                                                            <input aria-describedby="monatlicheHauptmahlzeiten-{{$index}}-error"
                                                                   class="form-control"
                                                                   id="monatlicheHauptmahlzeiten-{{$index}}" min="0"
                                                                   name="monatlicheHauptmahlzeiten-{{$index}}"
                                                                   ng-attr-data-test="monatliche-hauptmahlzeiten#{{$index}}"
                                                                   ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.monatlicheHauptmahlzeiten"
                                                                   ng-required="true"
                                                                   step="0.01"
                                                                   type="number">
                                                            <dv-error-messages
                                                                for="vm.form['monatlicheHauptmahlzeiten-' + $index].$error"
                                                                input-id="monatlicheHauptmahlzeiten-{{$index}}"
                                                                step="0.01"></dv-error-messages>
                                                        </div>
                                                    </dv-input-container>
                                                </div>
                                            </div>

                                            <!-- monatlicheNebenmahlzeiten -->
                                            <div class="col-sm-12 dv-input-container-small">
                                                <div class="form-group">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               for="monatlicheNebenmahlzeiten-{{$index}}">
                                                            <span data-translate="MONATLICHE_NEBENMAHLZEITEN"></span>
                                                            <dv-tooltip input-id="monatlicheNebenmahlzeiten-tooltip-{{$index}}"
                                                                        text="'MONATLICHE_NEBENMAHLZEITEN_HELP' | translate"></dv-tooltip>
                                                        </label>
                                                        <div class="dv-input-container-small" style="padding-right:32px;">
                                                            <input aria-describedby="monatlicheNebenmahlzeiten-{{$index}}-error"
                                                                   class="form-control"
                                                                   id="monatlicheNebenmahlzeiten-{{$index}}" min="0"
                                                                   name="monatlicheNebenmahlzeiten-{{$index}}"
                                                                   ng-attr-data-test="monatliche-nebenmahlzeiten#{{$index}}"
                                                                   ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.monatlicheNebenmahlzeiten"
                                                                   ng-required="true"
                                                                   step="0.01"
                                                                   type="number">
                                                            <dv-error-messages
                                                                for="vm.form['monatlicheNebenmahlzeiten-' + $index].$error"
                                                                input-id="monatlicheNebenmahlzeiten-{{$index}}"
                                                                step="0.01"></dv-error-messages>
                                                        </div>
                                                    </dv-input-container>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <!-- tarif Hauptmhalzeiten -->
                                            <div class="col-sm-12 dv-input-container-small">
                                                <div class="form-group">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               for="tarifProHauptmahlzeit-{{$index}}">
                                                            <span data-translate="TARIF_PRO_HAUPTMAHLZEIT"></span>
                                                            <dv-tooltip input-id="tarifProHauptmahlzeit-tooltip-{{$index}}"
                                                                        text="'TARIF_PRO_HAUPTMAHLZEIT_HELP' | translate"></dv-tooltip>
                                                        </label>
                                                        <div class="dv-input-container-small" style="padding-right:32px;">
                                                            <input aria-describedby="tarifProHauptmahlzeit-{{$index}}-error"
                                                                   class="form-control"
                                                                   id="tarifProHauptmahlzeit-{{$index}}" min="0"
                                                                   name="tarifProHauptmahlzeit-{{$index}}"
                                                                   ng-attr-data-test="tarif-pro-hauptmahlzeit#{{$index}}"
                                                                   ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.tarifProHauptmahlzeit"
                                                                   ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                                                   ng-required="true"
                                                                   step="0.05"
                                                                   type="number">
                                                            <dv-error-messages
                                                                for="vm.form['tarifProHauptmahlzeit-' + $index].$error"
                                                                input-id="tarifProHauptmahlzeit-{{$index}}"
                                                                step="0.05"></dv-error-messages>
                                                        </div>
                                                    </dv-input-container>
                                                </div>
                                            </div>
                                            <!-- tarif Nebenmahlzeiten -->
                                            <div class="col-sm-12 dv-input-container-small">
                                                <div class="form-group">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               for="tarifProNebenmahlzeit-{{$index}}">
                                                            <span data-translate="TARIF_PRO_NEBENMAHLZEIT"></span>
                                                            <dv-tooltip input-id="tarifProNebenmahlzeit-tooltip-{{$index}}"
                                                                        text="'TARIF_PRO_NEBENMAHLZEIT_HELP' | translate"></dv-tooltip>
                                                        </label>
                                                        <div class="dv-input-container-small" style="padding-right:32px;">
                                                            <input aria-describedby="tarifProNebenmahlzeit-{{$index}}-error"
                                                                   class="form-control"
                                                                   id="tarifProNebenmahlzeit-{{$index}}" min="0"
                                                                   name="tarifProNebenmahlzeit-{{$index}}"
                                                                   ng-attr-data-test="tarif-pro-nebenmahlzeit#{{$index}}"
                                                                   ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.tarifProNebenmahlzeit"
                                                                   ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                                                   ng-required="true"
                                                                   step="0.05"
                                                                   type="number">
                                                            <dv-error-messages
                                                                for="vm.form['tarifProNebenmahlzeit-' + $index].$error"
                                                                input-id="tarifProNebenmahlzeit-{{$index}}"
                                                                step="0.05"></dv-error-messages>
                                                        </div>
                                                    </dv-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- gueltig ab / gueltig bis -->
                                    <div class="row">
                                        <div class="col-sm-12 dv-input-container-small">
                                            <dv-input-container class="form-group">
                                                <label class="md-no-float"
                                                       data-translate="VON_BETREUUNG"
                                                       for="datumAb-{{$index}}">
                                                </label>
                                                <dv-datepicker class="input-element" input-id="datumAb-{{$index}}"
                                                               name="datumAb-{{$index}}"
                                                               ng-attr-data-test="betreuung-datum-ab#{{$index}}"
                                                               ng-attr-placeholder="{{'DATE_PLACEHOLDER' | translate}}"
                                                               ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.gueltigkeit.gueltigAb"
                                                               ng-required="true">
                                                </dv-datepicker>
                                                <dv-error-messages for="vm.form['datumAb-' + $index].$error"
                                                                   input-id="datumAb-{{$index}}"></dv-error-messages>
                                            </dv-input-container>
                                        </div>

                                        <div class="col-sm-12 dv-input-container-small">
                                            <dv-input-container class="form-group">
                                                <label class="md-no-float"
                                                       data-translate="BIS_BETREUUNG"
                                                       for="datumBis-{{$index}}">
                                                </label>
                                                <dv-datepicker class="input-element" input-id="datumBis-{{$index}}"
                                                               name="datumBis-{{$index}}"
                                                               ng-attr-data-test="betreuung-datum-bis#{{$index}}"
                                                               ng-attr-placeholder="{{'DATE_PLACEHOLDER' | translate}}"
                                                               ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.gueltigkeit.gueltigBis"
                                                               ng-required="false">
                                                </dv-datepicker>
                                                <dv-error-messages for="vm.form['datumBis-' + $index].$error"
                                                                   input-id="datumBis-{{$index}}"></dv-error-messages>
                                            </dv-input-container>
                                        </div>
                                    </div>

                                    <!-- Eingewohnung Pauschale pro Betreuungspensum -->
                                    <div ng-disabled="!vm.isEingewoehnungPauschaleEnabled()"
                                         ng-if="vm.showEingewoehnungPauschale()">
                                        <div class="row">
                                            <div class="col-sm-12 dv-input-container-question">
                                                <div class="checkbox">
                                                    <md-checkbox aria-label="{{'EINGEWOEHNUNG_PAUSCHALE_CHECKBOX'| translate}}"
                                                                 id="eingewoehnungPauschale-{{$index}}"
                                                                 name="eingewoehnungPauschale-{{$index}}"
                                                                 ng-change="vm.onEingewoehnungPauschaleChange($index)"
                                                                 ng-disabled="!vm.isEingewoehnungPauschaleEnabled()"
                                                                 ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.hasEingewoehnungsPauschale">
                                                        <span data-translate="EINGEWOEHNUNG_PAUSCHALE_CHECKBOX"></span>
                                                    </md-checkbox>
                                                    <div class="mock-dv-tooltip"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div ng-if="vm.getBetreuungspensum($index).betreuungspensumJA.hasEingewoehnungsPauschale">
                                            <div class="row">
                                                <div class="col-sm-12 dv-input-container-small">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               for="eingewoehnungPauschale">
                                                            <span data-translate="EINGEWOEHNUNG_PAUSCHALE"></span>
                                                            <dv-tooltip input-id="eingewoehnungPauschaleInfo-{{$index}}"
                                                                        text="'EINGEWOEHNUNG_PAUSCHALE_CHECKBOX_INFO' | translate"></dv-tooltip>
                                                        </label>
                                                        <div class="dv-input-container-small">
                                                            <input aria-describedby="eingewoehnungPauschale-error"
                                                                   class="form-control"
                                                                   id="eingewoehnungPauschale-{{$index}}" min="0"
                                                                   name="eingewoehnungPauschale-{{$index}}"
                                                                   ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.eingewoehnungPauschale.pauschale"
                                                                   ng-pattern="vm.CONSTANTS.PATTERN_TWO_DECIMALS"
                                                                   ng-required="true"
                                                                   step="0.05"
                                                                   type="number">
                                                            <dv-error-messages
                                                                for="vm.form['eingewoehnungPauschale-' + $index].$error"
                                                                input-id="eingewoehnungPauschale-{{$index}}"
                                                                step="0.05"></dv-error-messages>
                                                        </div>
                                                    </dv-input-container>
                                                </div>
                                            </div>

                                            <!-- gueltig ab / gueltig bis -->
                                            <div class="row">
                                                <div class="col-sm-12 dv-input-container-small">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               data-translate="VON_BETREUUNG"
                                                               for="eingewoehnungDatumAb-{{$index}}">
                                                        </label>
                                                        <dv-datepicker class="input-element"
                                                                       input-id="eingewoehnungDatumAb-{{$index}}"
                                                                       name="eingewoehnungDatumAb-{{$index}}"
                                                                       ng-attr-placeholder="{{'DATE_PLACEHOLDER' | translate}}"
                                                                       ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.eingewoehnungPauschale.gueltigkeit.gueltigAb"
                                                                       ng-required="true">
                                                        </dv-datepicker>
                                                        <dv-error-messages for="vm.form['eingewoehnungDatumAb-' + $index].$error"
                                                                           input-id="eingewoehnungDatumAb-{{$index}}"></dv-error-messages>
                                                    </dv-input-container>
                                                </div>

                                                <div class="col-sm-12 dv-input-container-small">
                                                    <dv-input-container class="form-group">
                                                        <label class="md-no-float"
                                                               data-translate="BIS_BETREUUNG"
                                                               for="eingewoehnungDatumBis-{{$index}}">
                                                        </label>
                                                        <dv-datepicker class="input-element"
                                                                       input-id="eingewoehnungDatumBis-{{$index}}"
                                                                       name="eingewoehnungDatumBis-{{$index}}"
                                                                       ng-attr-placeholder="{{'DATE_PLACEHOLDER' | translate}}"
                                                                       ng-model="vm.getBetreuungspensum($index).betreuungspensumJA.eingewoehnungPauschale.gueltigkeit.gueltigBis"
                                                                       ng-required="true">
                                                        </dv-datepicker>
                                                        <dv-error-messages for="vm.form['eingewoehnungDatumBis-' + $index].$error"
                                                                           input-id="eingewoehnungDatumBis-{{$index}}"></dv-error-messages>
                                                    </dv-input-container>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <betreuung-override-warning
                                        [betreuungskosten]="vm.getBetreuungspensum($index).betreuungspensumJA.monatlicheBetreuungskosten"
                                        [betreuungspensum]="vm.getBetreuungspensum($index).betreuungspensumJA.pensum"
                                        [gueltig-ab]="vm.getBetreuungspensum($index).betreuungspensumJA.gueltigkeit.gueltigAb"
                                        ng-if="vm.showOverrideWarning(vm.getBetreuungspensum($index))">
                                    </betreuung-override-warning>

                                    <!--Betreuungspensum entfernen. Wird nur angezeigt wenn status=AUSSTEHEND und es mehrere Betreuungspensen gibt und role=institution-->
                                    <div class="row margin-bottom-60 dv-input-container-medium"
                                         dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                                         dv-show-element
                                         dv-show-expression="($index > 0) || (vm.getBetreuungspensen().length > 1)">
                                        <div class="col-md-12">
                                            <dv-loading-button button-class="dv-btn-operation"
                                                               button-click="vm.removeBetreuungspensum(betpen)"
                                                               button-disabled="!vm.isPensumEditable()"
                                                               type="button">
                                                <i aria-label="{{'BETREUUNGSPENSUM_DELETE' | translate}}"
                                                   class="fa fa-lg fa-trash-o"
                                                   title="{{'BETREUUNGSPENSUM_DELETE' | translate}}"></i>
                                                <span data-translate="BETREUUNGSPENSUM_ENTFERNEN_INDEX"
                                                      data-translate-value-betreuungspensumnumber="{{$index + 1}}"></span>
                                            </dv-loading-button>
                                            <hr class="header"/>
                                        </div>
                                    </div>
                                </div>

                                <!--Neues Betreuungspensum hinzufuegen-->
                                <div class="row" dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                                     dv-show-element
                                     dv-show-expression="vm.isPensumEditable()">
                                    <div class="col-md-12">
                                        <dv-loading-button button-class="dv-btn-operation"
                                                           button-click="vm.createBetreuungspensum()"
                                                           data-test="container.add-betreuungspensum"
                                                           dv-enable-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                                                           dv-enable-element
                                                           dv-enable-expression="vm.isEnabled()"
                                                           type="button">
                                            <i class="fa fa-lg fa-plus-circle"></i>
                                            <span data-translate="BETREUUNGSPENSUM_ERFASSEN"></span>
                                        </dv-loading-button>
                                    </div>
                                </div>

                                <!--grund Ablehnung-->
                                <div class="row margin-top-20"
                                     dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                                     dv-show-element>
                                    <div class="col-md-12 dv-input-container-medium">
                                        <dv-input-container class="form-group">
                                            <label class="md-no-float inline-hint" data-translate="GRUND_ABLEHNUNG"
                                                   for="grundAblehnung"></label>
                                            <textarea class="form-control" data-test="grund-ablehnung" id="grundAblehnung"
                                                      maxlength="4000"
                                                      md-no-autogrow
                                                      ng-disabled="!vm.isBetreuungsstatusWarten() || vm.isSavingData"
                                                      ng-model="vm.getBetreuungModel().grundAblehnung"
                                                      rows="6">
                                        </textarea>
                                        </dv-input-container>
                                    </div>
                                </div>
                                <!-- Bestätigung Korrekte Kostenangabe -->
                                <div class="row margin-bottom-10"
                                     dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                                     dv-show-element
                                     dv-show-expression="vm.isBetreuungsstatusWarten()">
                                    <div class="col-xs-12 dv-input-container-question">
                                        <div class="checkbox-bestaetigung">
                                            <md-checkbox aria-label="{{'KORREKTE_KOSTEN_BESTAETIGUNG_1'|translate}}"
                                                         data-test="korrekte-kosten-bestaetigung"
                                                         name="korrekteKostenBestaetigung"
                                                         ng-model="vm.korrekteKostenBestaetigung"
                                                         ng-required="vm.isBestaetigenClicked">
                                                <span data-translate="KORREKTE_KOSTEN_BESTAETIGUNG_1"></span>
                                            </md-checkbox>
                                            <div class="dv-error-messages"
                                                 ng-if="vm.isBestaetigenClicked && !vm.korrekteKostenBestaetigung">
                                                <div class="error"
                                                     ng-messages="vm.form.korrekteKostenBestaetigung.$error">
                                                    <div data-translate="KORREKTE_KOSTEN_BESTAETIGUNG_ERROR"
                                                         for="vm.form.korrekteKostenBestaetigung.$error"
                                                         ng-message="required"
                                                         role="alert"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-12">
                                        <ul>
                                            <li ng-if="!vm.gesuchModelManager.isFKJVTexte && ('KORREKTE_KOSTEN_BESTAETIGUNG_2' | translate).length > 0">{{ 'KORREKTE_KOSTEN_BESTAETIGUNG_2' | translate }}</li>
                                            <li ng-if="vm.gesuchModelManager.isFKJVTexte">{{ 'KORREKTE_KOSTEN_BESTAETIGUNG_2_FKJV' | translate }}</li>
                                            <li ng-if="('KORREKTE_KOSTEN_BESTAETIGUNG_3' | translate).length > 0">{{ 'KORREKTE_KOSTEN_BESTAETIGUNG_3' | translate }}</li>
                                            <li ng-if="('KORREKTE_KOSTEN_BESTAETIGUNG_4' | translate).length > 0">{{ 'KORREKTE_KOSTEN_BESTAETIGUNG_4' | translate }}</li>
                                        </ul>
                                    </div>
                                </div>
                            </fieldset>
                        </div>


                        <!-- Status texts -->
                        <div class="well well-status-warten" ng-if="vm.isBetreuungsstatusWarten() && !vm.isSavingData">
                            <i aria-hidden="true" class="fa fa-hourglass"></i>
                            <span data-translate="BETREUUNG_WARTEN_TEXT"></span>
                            <span data-translate="INSTITUTION_EINGELADEN_WARN_TEXT" ng-if="vm.showWarningStammdaten()"></span>
                        </div>

                        <div class="well well-status-abgewiesen"
                             ng-if="vm.isBetreuungsstatusAbgewiesen() && !vm.isSavingData">
                            <i aria-hidden="true" class="fa fa-times"></i>
                            <span data-translate="BETREUUNG_ABGEWIESEN_TEXT"
                                  data-translate-value-date="{{vm.getBetreuungModel().datumAblehnung  | amDateFormat : 'DD.MM.YYYY'}}"
                                  data-translate-value-grund="{{vm.getBetreuungModel().grundAblehnung}}">
                            </span>
                        </div>
                        <div class="row">
                            <div class="col-md-12"
                                 ng-if="vm.isBetreuungsstatusBestaetigtOrVerfuegt() && !vm.isSavingData">
                                <div class=" well well-status-bestaetigt">
                                    <i aria-hidden="true" class="fa fa-check"></i>
                                    <span data-translate="BETREUUNG_BESTAETIGT_TEXT"
                                          data-translate-value-date="{{vm.getBetreuungModel().datumBestaetigung  | amDateFormat : 'DD.MM.YYYY'}}"></span>
                                </div>
                            </div>
                        </div>
                        <div class="well well-status-bestaetigt"
                             ng-if="vm.isBetreuungsstatusNichtEingetreten() && !vm.isSavingData">
                            <i aria-hidden="true" class="fa fa-check"></i>
                            <span data-translate="BETREUUNG_NICHT_EINGETRETEN_TEXT"
                                  data-translate-value-date="{{vm.getBetreuungModel().datumBestaetigung  | amDateFormat : 'DD.MM.YYYY'}}"></span>
                        </div>
                        <div class="well well-status-bestaetigt" ng-if="vm.isStorniert() && !vm.isSavingData">
                            <i aria-hidden="true" class="fa fa-exclamation"></i>
                            <span data-translate="BETREUUNG_STORNIERT_TEXT"></span>
                        </div>

                        <!--falsche Angaben-->
                        <div class="row"
                             dv-show-allowed-roles="vm.TSRoleUtil.getGesuchstellerSozialdienstJugendamtSchulamtRoles()"
                             dv-show-element
                             dv-show-expression="vm.showFalscheAngaben()">
                            <div class="col-md-12">
                                <a data-translate="FALSCHE_ANGABEN" href=""
                                   ng-click="vm.angabenKorrigieren()"></a>
                            </div>
                        </div>

                        <!--Angabe korrigieren-->
                        <div class="row"
                             dv-show-allowed-roles="vm.TSRoleUtil.getGesuchstellerSozialdienstJugendamtSchulamtRoles()"
                             dv-show-element
                             dv-show-expression="vm.showAngabenKorrigieren()">
                            <div class="col-md-12">
                                <a data-translate="ANGABEN_KORRIGIEREN" href=""
                                   ng-click="vm.angabenKorrigieren()"></a>
                            </div>
                        </div>

                        <!--Hint-->
                        <div ng-if="vm.isProvisorischeBetreuung()">
                            <p class="inline-hint margin-top-20" data-translate="BETREUUNGSPENSUM_HINT2"
                               dv-show-allowed-roles="vm.TSRoleUtil.getGesuchstellerRoles()" dv-show-element
                               dv-show-expression="!vm.isSchulamt()"></p>
                        </div>

                    </div>
                </fieldset>

                <!-- Tagesschule -->
                <div ng-if="vm.displayModuleTagesschule()">
                    <betreuung-tagesschule-view anmeldung-schulamt-ablehnen="vm.anmeldungSchulamtAblehnen()"
                                                anmeldung-schulamt-falsche-angaben="vm.anmeldungSchulamtFalscheAngaben()"
                                                anmeldung-schulamt-falsche-institution="vm.anmeldungSchulamtFalscheInstitution()"
                                                anmeldung-schulamt-stornieren="vm.anmeldungSchulamtStornieren()"
                                                anmeldung-schulamt-uebernehmen="vm.anmeldungSchulamtUebernehmen(isScolaris)"
                                                betreuung="vm.getBetreuungModel()"
                                                cancel="vm.cancel()"
                                                form="vm.form"
                                                on-save="vm.anmeldenSchulamt()">
                    </betreuung-tagesschule-view>
                </div>

                <!-- Ferieninsel -->
                <div ng-if="vm.isFerieninsel()">
                    <betreuung-ferieninsel-view anmeldung-schulamt-ablehnen="vm.anmeldungSchulamtAblehnen()"
                                                anmeldung-schulamt-falsche-institution="vm.anmeldungSchulamtFalscheInstitution()"
                                                anmeldung-schulamt-uebernehmen="vm.anmeldungSchulamtUebernehmen(isScolaris)"
                                                betreuung="vm.getBetreuungModel()"
                                                cancel="vm.cancel()"
                                                form="vm.form"
                                                on-save="vm.anmeldenSchulamt()">
                    </betreuung-ferieninsel-view>
                </div>

                <!--Buttons-->
                <!--Hier wird die Direktive dv-navigation nicht benutzt. Grund dafuer ist, dass die Logik in diesem Fall sehr kompliziert ist.
                    wenn wir die Direktive benutzen wollen muessen wir viel anpassen, daher lohnt es sich die Buttons direkt zu erstellen-->
                <!-- todo verbessern. Es muss fuer alle Angebottypen geprueft werden ob die Buttons hier oder in den individuellen Component implementiert sind-->
                <div class="dv-navigation dv-navigation-flex" ng-if="vm.displayGlobalNavigationButtons()">
                    <!--Die Order der Knoepfe soll im HTML so sein, dass der weiter Knopf als erster im Form ist, dies wird dann fuer die darstelltung
                    mit Flexlayout wieder korrigiert. Grund ist, dass beim druecken von Enter in einem input Feld automaitisch der erste submit button triggered wird-->
                    <span dv-show-allowed-roles="vm.TSRoleUtil.getGesuchstellerSozialdienstJugendamtSchulamtRoles()"
                          dv-show-element
                          dv-show-expression="vm.isTagesschule() && !vm.tageschuleSaveDisabled()">

                        <dv-loading-button button-class="save" button-click="vm.saveSchulamt()"
                                           type="submit">
                            <span class="uppercase" data-translate="SPEICHERN"></span>
                        </dv-loading-button>
                    </span>

                    <span dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                          dv-show-element
                          dv-show-expression="vm.isMutationsmeldungAllowed() && !vm.isMutationsmeldungStatus && vm.abweichungenAktiviert">
                        <dv-loading-button aria-label="{{'ABWEICHUNGEN_MELDEN' | translate}}"
                                           button-click="vm.gotoBetreuungAbweichungen()"
                                           data-test="abweichungen-melden">
                            <span class="uppercase" data-translate="ABWEICHUNGEN_MELDEN"></span>
                        </dv-loading-button>
                    </span>

                    <!--Institution Buttons-->
                    <span dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                          dv-show-element
                          dv-show-expression="vm.isMutationsmeldungAllowed()">

                        <dv-loading-button aria-label="{{MUTATIONSMELDUNG_ERSTELLEN | translate}}"
                                           button-click="vm.mutationsmeldungErstellen()"
                                           data-test="mutationsmeldung-erstellen"
                                           ng-if="!vm.isMutationsmeldungStatus">
                            <span class="uppercase" data-translate="MUTATIONSMELDUNG_ERSTELLEN"></span>
                        </dv-loading-button>
                        <dv-loading-button aria-label="{{MUTATIONSMELDUNG_SENDEN | translate}}"
                                           button-click="vm.preMutationsmeldungSenden()"
                                           data-test="mutationsmeldung-senden"
                                           ng-if="vm.isMutationsmeldungStatus">
                            <span class="uppercase" data-translate="MUTATIONSMELDUNG_SENDEN"></span>
                        </dv-loading-button>
                    </span>

                    <span dv-show-allowed-roles="vm.TSRoleUtil.getTraegerschaftInstitutionRoles()"
                          dv-show-element
                          dv-show-expression="vm.isBetreuungsstatusWarten()">

                        <span ng-if="vm.isFromMutation()">
                            <dv-loading-button aria-label="{{'STORNIEREN' | translate}}"
                                               button-click="vm.stornieren()"
                                               data-test="container.platz-stornieren">
                                <span class="uppercase" data-translate="STORNIEREN"></span>
                            </dv-loading-button>
                        </span>

                        <span ng-if="vm.isStammdatenAusgefuellt()">
                            <dv-loading-button aria-label="{{'PLATZ_BESTAETIGEN' | translate}}"
                                               button-click="vm.platzBestaetigen()"
                                               data-test="container.platz-bestaetigen"
                                               type="submit">
                                <span class="uppercase" data-translate="PLATZ_BESTAETIGEN"></span>
                            </dv-loading-button>
                        </span>

                        <span ng-if="!vm.isFromMutation()">
                            <dv-loading-button aria-label="{{'ABWEISEN' | translate}}" button-click="vm.platzAbweisen()"
                                               data-test="container.platz-abweisen"
                                               type="submit">
                                <span class="uppercase" data-translate="ABWEISEN"></span>
                            </dv-loading-button>
                        </span>

                    </span>

                    <!--Platz anfordern-->
                    <span dv-show-allowed-roles="vm.TSRoleUtil.getGesuchstellerSozialdienstJugendamtSchulamtRoles()"
                          dv-show-element
                          dv-show-expression="vm.isBetreuungsstatusAusstehendOrUnbekannteInstitution() && !vm.isProvisorischeBetreuung()">
                        <dv-loading-button button-click="vm.platzAnfordern()"
                                           data-test="container.platzbestaetigung-anfordern"
                                           type="submit">
                            <span class="uppercase" data-translate="PLATZBESTAETIGUNG_ANFORDERN"></span>
                        </dv-loading-button>
                    </span>

                    <!-- Save -->
                    <span dv-show-allowed-roles="vm.TSRoleUtil.getAdminJaSchulamtSozialdienstGesuchstellerRoles()"
                          dv-show-element
                          dv-show-expression="(vm.enableFieldsEditedByGemeinde() && !vm.isBetreuungsstatusAusstehendOrUnbekannteInstitution())">
                        <dv-loading-button button-click="vm.saveBetreuung()" data-test="container.save" type="submit">
                            <span class="uppercase" data-translate="SPEICHERN"></span>
                        </dv-loading-button>
                    </span>

                    <!-- Save provisorische Berechnung-->
                    <span dv-show-allowed-roles="vm.TSRoleUtil.getGesuchstellerRoles()"
                          dv-show-element
                          dv-show-expression="vm.isProvisorischeBetreuung() && vm.isEnabled()">
                        <dv-loading-button button-click="vm.saveProvisorischeBetreuung()"
                                           data-test="container.save-provisorisch"
                                           type="submit">
                            <span class="uppercase" data-translate="SPEICHERN"></span>
                        </dv-loading-button>
                    </span>

                    <!-- Abbrechen -->
                    <span>
                        <dv-loading-button button-class="cancel-button" button-click="vm.cancel()" data-test="container.cancel"
                                           type="reset">
                            <span class="uppercase" data-translate="ABBRECHEN"></span>
                        </dv-loading-button>
                    </span>
                </div>
            </form>
        </div>
    </div>
</div>
